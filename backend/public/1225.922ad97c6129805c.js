"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1225,7291],{1889:(b,v,h)=>{h.d(v,{Wi:()=>d,__:()=>a});var a=function(u){return u.Documents="DOCUMENTS",u.Data="DATA",u.Library="LIBRARY",u.Cache="CACHE",u.External="EXTERNAL",u.ExternalStorage="EXTERNAL_STORAGE",u.ExternalCache="EXTERNAL_CACHE",u.LibraryNoCloud="LIBRARY_NO_CLOUD",u.Temporary="TEMPORARY",u}(a||{}),d=function(u){return u.UTF8="utf8",u.ASCII="ascii",u.UTF16="utf16",u}(d||{})},2739:(b,v,h)=>{h.d(v,{YA:()=>_,__:()=>m.__});var a=h(5083),d=h(5873),m=h(1889);const _=(0,a.F3)("Filesystem",{web:()=>h.e(2937).then(h.bind(h,2937)).then(u=>new u.FilesystemWeb)});(0,d.Y)()},4843:(b,v,h)=>{h.d(v,{_:()=>m});var a=h(9350),d=h(7707);function m(_,u){const f="object"==typeof u;return new Promise((p,P)=>{const y=new d.Ms({next:E=>{p(E),y.unsubscribe()},error:P,complete:()=>{f?p(u.defaultValue):P(new a.G)}});_.subscribe(y)})}},5873:(b,v,h)=>{h.d(v,{Y:()=>_});var a=h(467);function _(u=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},void 0===window.Capacitor||u?void 0!==window.cordova&&function m(u){u.CapacitorUtils.Synapse=new Proxy({},{get:(f,p)=>u.cordova.plugins[p]})}(window):function d(u){u.CapacitorUtils.Synapse=new Proxy({},{get:(f,p)=>new Proxy({},{get:(P,y)=>(E,A,r)=>{const e=u.Capacitor.Plugins[p];void 0!==e?"function"==typeof e[y]?(0,a.A)(function*(){try{const o=yield e[y](E);A(o)}catch(o){r(o)}})():r(new Error(`Method ${y} not found in Capacitor plugin ${p}`)):r(new Error(`Capacitor plugin ${p} not found`))}})})}(window))}},7291:(b,v,h)=>{h.d(v,{n:()=>P});var a=h(467),d=h(8254),m=h(2615);const f="photos",p="projects";let P=(()=>{var y;class E{constructor(){this.SYNC_QUEUE_KEY="geotech_sync_queue",this.MEASUREMENTS_KEY="geotech_measurements",this.db=null,this.dbReady=null,this.dbReady=this.initIndexedDB()}initIndexedDB(){var r=this;return(0,a.A)(function*(){return r.db?r.db:new Promise((e,o)=>{const t=indexedDB.open("geotech_db",2);t.onerror=()=>{console.error("Error opening IndexedDB:",t.error),o(t.error)},t.onsuccess=()=>{r.db=t.result,e(r.db)},t.onupgradeneeded=n=>{const i=n.target.result;i.objectStoreNames.contains(f)||i.createObjectStore(f,{keyPath:"id"}).createIndex("projectId","projectId",{unique:!1}),i.objectStoreNames.contains(p)||i.createObjectStore(p,{keyPath:"id"})}})})()}getDB(){var r=this;return(0,a.A)(function*(){return r.db?r.db:r.dbReady?r.dbReady:r.initIndexedDB()})()}getProjects(){var r=this;return(0,a.A)(function*(){try{const e=yield r.getDB();return new Promise((o,t)=>{const s=e.transaction([p],"readonly").objectStore(p).getAll();s.onsuccess=()=>o(s.result||[]),s.onerror=()=>t(s.error)})}catch(e){return console.error("Error getting projects from IndexedDB:",e),r.getProjectsFromPreferences()}})()}getProjectsFromPreferences(){return(0,a.A)(function*(){const{value:r}=yield d.p.get({key:"geotech_projects"});return r?JSON.parse(r):[]})()}setProjects(r){var e=this;return(0,a.A)(function*(){try{const n=(yield e.getDB()).transaction([p],"readwrite").objectStore(p);n.clear();for(const i of r)n.put(i)}catch(o){console.error("Error setting projects:",o)}})()}saveProject(r){var e=this;return(0,a.A)(function*(){try{const o=yield e.getDB();return new Promise((t,n)=>{const c=o.transaction([p],"readwrite").objectStore(p).put(r);c.onsuccess=()=>t(),c.onerror=()=>n(c.error)})}catch(o){throw console.error("Error saving project:",o),o}})()}deleteProject(r){var e=this;return(0,a.A)(function*(){try{const o=yield e.getDB();yield new Promise((n,i)=>{const l=o.transaction([p],"readwrite").objectStore(p).delete(r);l.onsuccess=()=>n(),l.onerror=()=>i(l.error)});const t=yield e.getPhotos(r);for(const n of t)yield e.deletePhoto(n.id)}catch(o){console.error("Error deleting project:",o)}})()}getProject(r){var e=this;return(0,a.A)(function*(){try{const o=yield e.getDB();return new Promise((t,n)=>{const c=o.transaction([p],"readonly").objectStore(p).get(r);c.onsuccess=()=>t(c.result),c.onerror=()=>n(c.error)})}catch(o){return void console.error("Error getting project:",o)}})()}getPhotos(r){var e=this;return(0,a.A)(function*(){try{const o=yield e.getDB();return new Promise((t,n)=>{const s=o.transaction([f],"readonly").objectStore(f);if(r){const l=s.index("projectId").getAll(r);l.onsuccess=()=>t(l.result||[]),l.onerror=()=>n(l.error)}else{const c=s.getAll();c.onsuccess=()=>t(c.result||[]),c.onerror=()=>n(c.error)}})}catch(o){return console.error("Error getting photos:",o),[]}})()}savePhoto(r){var e=this;return(0,a.A)(function*(){try{const o=yield e.getDB();return new Promise((t,n)=>{const c=o.transaction([f],"readwrite").objectStore(f).put(r);c.onsuccess=()=>t(),c.onerror=()=>{console.error("Error saving photo:",c.error),n(c.error)}})}catch(o){throw console.error("Error saving photo to IndexedDB:",o),o}})()}addPhoto(r){var e=this;return(0,a.A)(function*(){yield e.savePhoto(r)})()}updatePhoto(r){var e=this;return(0,a.A)(function*(){yield e.savePhoto(r)})()}deletePhoto(r){var e=this;return(0,a.A)(function*(){try{const o=yield e.getDB();return new Promise((t,n)=>{const c=o.transaction([f],"readwrite").objectStore(f).delete(r);c.onsuccess=()=>t(),c.onerror=()=>n(c.error)})}catch(o){console.error("Error deleting photo:",o)}})()}getPhoto(r){var e=this;return(0,a.A)(function*(){try{const o=yield e.getDB();return new Promise((t,n)=>{const c=o.transaction([f],"readonly").objectStore(f).get(r);c.onsuccess=()=>t(c.result),c.onerror=()=>n(c.error)})}catch(o){return void console.error("Error getting photo:",o)}})()}getSyncQueue(){var r=this;return(0,a.A)(function*(){const{value:e}=yield d.p.get({key:r.SYNC_QUEUE_KEY});return e?JSON.parse(e):[]})()}addToSyncQueue(r){var e=this;return(0,a.A)(function*(){const o=yield e.getSyncQueue();o.push(r),yield d.p.set({key:e.SYNC_QUEUE_KEY,value:JSON.stringify(o)})})()}updateSyncQueueItem(r){var e=this;return(0,a.A)(function*(){const o=yield e.getSyncQueue(),t=o.findIndex(n=>n.id===r.id);t>=0&&(o[t]=r,yield d.p.set({key:e.SYNC_QUEUE_KEY,value:JSON.stringify(o)}))})()}removeFromSyncQueue(r){var e=this;return(0,a.A)(function*(){const t=(yield e.getSyncQueue()).filter(n=>n.id!==r);yield d.p.set({key:e.SYNC_QUEUE_KEY,value:JSON.stringify(t)})})()}clearSyncQueue(){var r=this;return(0,a.A)(function*(){yield d.p.set({key:r.SYNC_QUEUE_KEY,value:JSON.stringify([])})})()}getPendingSyncCount(){var r=this;return(0,a.A)(function*(){return(yield r.getSyncQueue()).filter(o=>"pending"===o.status).length})()}generateId(){return"local_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}clearAll(){var r=this;return(0,a.A)(function*(){yield d.p.clear();try{const o=(yield r.getDB()).transaction([f,p],"readwrite");o.objectStore(f).clear(),o.objectStore(p).clear()}catch(e){console.error("Error clearing IndexedDB:",e)}})()}clear(){var r=this;return(0,a.A)(function*(){yield r.clearAll()})()}getMeasurements(){var r=this;return(0,a.A)(function*(){const{value:e}=yield d.p.get({key:r.MEASUREMENTS_KEY});return e?JSON.parse(e):[]})()}saveMeasurement(r){var e=this;return(0,a.A)(function*(){const o=yield e.getMeasurements(),t=o.findIndex(n=>n.id===r.id);t>=0?o[t]=r:o.unshift(r),yield d.p.set({key:e.MEASUREMENTS_KEY,value:JSON.stringify(o)})})()}deleteMeasurement(r){var e=this;return(0,a.A)(function*(){const t=(yield e.getMeasurements()).filter(n=>n.id!==r);yield d.p.set({key:e.MEASUREMENTS_KEY,value:JSON.stringify(t)})})()}clearMeasurements(){var r=this;return(0,a.A)(function*(){yield d.p.set({key:r.MEASUREMENTS_KEY,value:JSON.stringify([])})})()}migrateToIndexedDB(){var r=this;return(0,a.A)(function*(){try{const{value:e}=yield d.p.get({key:"geotech_projects"});if(e){const t=JSON.parse(e);if(t.length>0){console.log(`Migrando ${t.length} proyectos a IndexedDB...`);for(const n of t)yield r.saveProject(n);yield d.p.remove({key:"geotech_projects"}),console.log("Proyectos migrados")}}const{value:o}=yield d.p.get({key:"geotech_photos"});if(o){const t=JSON.parse(o);if(t.length>0){console.log(`Migrando ${t.length} fotos a IndexedDB...`);for(const n of t)yield r.savePhoto(n);yield d.p.remove({key:"geotech_photos"}),console.log("Fotos migradas")}}}catch(e){console.error("Error durante migraci\xf3n:",e)}})()}static#e=y=()=>(this.\u0275fac=function(e){return new(e||E)},this.\u0275prov=m.jDH({token:E,factory:E.\u0275fac,providedIn:"root"}))}return y(),E})()},9473:(b,v,h)=>{h.d(v,{j:()=>A});var a=h(467),d=h(5083),m=function(r){return r.Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS",r}(m||{}),_=function(r){return r.Rear="REAR",r.Front="FRONT",r}(_||{}),u=function(r){return r.Uri="uri",r.Base64="base64",r.DataUrl="dataUrl",r}(u||{});class f extends d.E_{getPhoto(e){var o=this;return(0,a.A)(function*(){return new Promise(function(){var t=(0,a.A)(function*(n,i){if(e.webUseInput||e.source===m.Photos)o.fileInputExperience(e,n,i);else if(e.source===m.Prompt){let s=document.querySelector("pwa-action-sheet");s||(s=document.createElement("pwa-action-sheet"),document.body.appendChild(s)),s.header=e.promptLabelHeader||"Photo",s.cancelable=!1,s.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],s.addEventListener("onSelection",function(){var c=(0,a.A)(function*(l){0===l.detail?o.fileInputExperience(e,n,i):o.cameraExperience(e,n,i)});return function(l){return c.apply(this,arguments)}}())}else o.cameraExperience(e,n,i)});return function(n,i){return t.apply(this,arguments)}}())})()}pickImages(e){var o=this;return(0,a.A)(function*(){return new Promise(function(){var t=(0,a.A)(function*(n,i){o.multipleFileInputExperience(n,i)});return function(n,i){return t.apply(this,arguments)}}())})()}cameraExperience(e,o,t){var n=this;return(0,a.A)(function*(){if(customElements.get("pwa-camera-modal")){const i=document.createElement("pwa-camera-modal");i.facingMode=e.direction===_.Front?"user":"environment",document.body.appendChild(i);try{yield i.componentOnReady(),i.addEventListener("onPhoto",function(){var s=(0,a.A)(function*(c){const l=c.detail;null===l?t(new d.I9("User cancelled photos app")):l instanceof Error?t(l):o(yield n._getCameraPhoto(l,e)),i.dismiss(),document.body.removeChild(i)});return function(c){return s.apply(this,arguments)}}()),i.present()}catch{n.fileInputExperience(e,o,t)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),n.fileInputExperience(e,o,t)})()}fileInputExperience(e,o,t){let n=document.querySelector("#_capacitor-camera-input");const i=()=>{var s;null===(s=n.parentNode)||void 0===s||s.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input",n.type="file",n.hidden=!0,document.body.appendChild(n),n.addEventListener("change",s=>{const c=n.files[0];let l="jpeg";if("image/png"===c.type?l="png":"image/gif"===c.type&&(l="gif"),"dataUrl"===e.resultType||"base64"===e.resultType){const g=new FileReader;g.addEventListener("load",()=>{if("dataUrl"===e.resultType)o({dataUrl:g.result,format:l});else if("base64"===e.resultType){const w=g.result.split(",")[1];o({base64String:w,format:l})}i()}),g.readAsDataURL(c)}else o({webPath:URL.createObjectURL(c),format:l}),i()}),n.addEventListener("cancel",s=>{t(new d.I9("User cancelled photos app")),i()})),n.accept="image/*",n.capture=!0,e.source===m.Photos||e.source===m.Prompt?n.removeAttribute("capture"):e.direction===_.Front?n.capture="user":e.direction===_.Rear&&(n.capture="environment"),n.click()}multipleFileInputExperience(e,o){let t=document.querySelector("#_capacitor-camera-input-multiple");const n=()=>{var i;null===(i=t.parentNode)||void 0===i||i.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input-multiple",t.type="file",t.hidden=!0,t.multiple=!0,document.body.appendChild(t),t.addEventListener("change",i=>{const s=[];for(let c=0;c<t.files.length;c++){const l=t.files[c];let g="jpeg";"image/png"===l.type?g="png":"image/gif"===l.type&&(g="gif"),s.push({webPath:URL.createObjectURL(l),format:g})}e({photos:s}),n()}),t.addEventListener("cancel",i=>{o(new d.I9("User cancelled photos app")),n()})),t.accept="image/*",t.click()}_getCameraPhoto(e,o){return new Promise((t,n)=>{const i=new FileReader,s=e.type.split("/")[1];"uri"===o.resultType?t({webPath:URL.createObjectURL(e),format:s,saved:!1}):(i.readAsDataURL(e),i.onloadend=()=>{const c=i.result;t("dataUrl"===o.resultType?{dataUrl:c,format:s,saved:!1}:{base64String:c.split(",")[1],format:s,saved:!1})},i.onerror=c=>{n(c)})})}checkPermissions(){var e=this;return(0,a.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw e.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw e.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var e=this;return(0,a.A)(function*(){throw e.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var e=this;return(0,a.A)(function*(){throw e.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var e=this;return(0,a.A)(function*(){throw e.unavailable("Not implemented on web.")})()}}new f;const P=(0,d.F3)("Camera",{web:()=>new f});var y=h(2739),E=h(2615);let A=(()=>{var r;class e{constructor(){}takePhoto(){var t=this;return(0,a.A)(function*(){if(!d.Ii.isNativePlatform())return t.takeWebPhoto();const n=yield P.getPhoto({resultType:u.Uri,source:m.Camera,quality:90,width:1920,height:1080,correctOrientation:!0,saveToGallery:!1});return yield t.savePicture(n)})()}takeWebPhoto(){var t=this;return new Promise((n,i)=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.capture="environment",s.style.cssText="position: fixed; top: -100px; left: -100px; opacity: 0; pointer-events: none;",document.body.appendChild(s),s.addEventListener("change",(0,a.A)(function*(){const c=s.files?.[0];if(document.body.removeChild(s),c)try{const l=yield t.fileToBase64(c),g=URL.createObjectURL(c);n({filepath:"web_"+Date.now()+".jpeg",webviewPath:g,webPath:g,base64:l})}catch(l){i(l)}else i(new Error("No se selecciono ninguna imagen"))})),s.addEventListener("cancel",()=>{document.body.removeChild(s),i(new Error("Captura cancelada"))}),s.click()})}fileToBase64(t){return new Promise((n,i)=>{const s=new FileReader;s.onerror=i,s.onload=()=>{const l=s.result.split(",")[1];n(l)},s.readAsDataURL(t)})}pickFromGallery(){var t=this;return(0,a.A)(function*(){if(!d.Ii.isNativePlatform())return t.takeWebPhoto();const n=yield P.getPhoto({resultType:u.Uri,source:m.Photos,quality:90,width:1920,height:1080,correctOrientation:!0});return yield t.savePicture(n)})()}savePicture(t){var n=this;return(0,a.A)(function*(){const i=yield n.readAsBase64(t),s="geotech_"+(new Date).getTime()+".jpeg";return{filepath:(yield y.YA.writeFile({path:"photos/"+s,data:i,directory:y.__.Data,recursive:!0})).uri,webviewPath:t.webPath||"",webPath:t.webPath||"",base64:i}})()}readAsBase64(t){var n=this;return(0,a.A)(function*(){const s=yield(yield fetch(t.webPath)).blob();return yield n.convertBlobToBase64(s)})()}convertBlobToBase64(t){return new Promise((n,i)=>{const s=new FileReader;s.onerror=i,s.onload=()=>{const l=s.result.split(",")[1];n(l)},s.readAsDataURL(t)})}deletePhoto(t){return(0,a.A)(function*(){try{yield y.YA.deleteFile({path:t,directory:y.__.Data})}catch(n){console.error("Error deleting photo:",n)}})()}getPhotoBase64(t){return(0,a.A)(function*(){return(yield y.YA.readFile({path:t,directory:y.__.Data})).data})()}static#e=r=()=>(this.\u0275fac=function(n){return new(n||e)},this.\u0275prov=E.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}))}return r(),e})()}}]);