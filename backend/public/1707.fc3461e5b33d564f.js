"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1707],{1707:(y,u,s)=>{s.r(u),s.d(u,{ProjectsPageModule:()=>D});var m=s(2200),h=s(4341),c=s(7343),f=s(8132),p=s(467),_=s(4843),t=s(3664),g=s(2615),P=s(3366),v=s(7291),b=s(6386),x=s(2092),C=s(1924),M=s(9330);function O(r,a){1&r&&(t.j41(0,"div",10),t.nrm(1,"ion-icon",11),t.j41(2,"span"),t.EFF(3,"Modo sin conexion"),t.k0s()())}function k(r,a){1&r&&(t.j41(0,"div",12),t.nrm(1,"ion-spinner",13),t.j41(2,"p"),t.EFF(3,"Cargando proyectos..."),t.k0s()())}function I(r,a){if(1&r){const l=t.RV6();t.j41(0,"div",14)(1,"div",15),t.nrm(2,"ion-icon",16),t.k0s(),t.j41(3,"h3",17),t.EFF(4,"Sin proyectos"),t.k0s(),t.j41(5,"p",18),t.EFF(6,"Crea tu primer proyecto para comenzar a gestionar tus trabajos de campo."),t.k0s(),t.j41(7,"ion-button",19),t.bIt("click",function(){g.eBV(l);const n=t.XpG();return g.Njj(n.createProject())}),t.nrm(8,"ion-icon",20),t.EFF(9," Crear proyecto "),t.k0s()()}}function E(r,a){if(1&r&&(t.j41(0,"span"),t.nrm(1,"ion-icon",33),t.EFF(2),t.k0s()),2&r){const l=t.XpG().$implicit;t.R7$(2),t.SpI(" ",l.photoCount," fotos ")}}function F(r,a){if(1&r&&(t.j41(0,"p",34),t.nrm(1,"ion-icon",35),t.EFF(2),t.k0s()),2&r){const l=t.XpG().$implicit;t.R7$(2),t.SpI(" ",l.location," ")}}function R(r,a){if(1&r){const l=t.RV6();t.j41(0,"ion-item",23),t.bIt("click",function(){const n=g.eBV(l).$implicit,o=t.XpG(2);return g.Njj(o.openProject(n))}),t.j41(1,"div",24),t.nrm(2,"ion-icon",25),t.k0s(),t.j41(3,"ion-label")(4,"h2",26),t.EFF(5),t.k0s(),t.j41(6,"p",27),t.nrm(7,"ion-icon",28),t.EFF(8),t.DNE(9,E,3,1,"span",29),t.k0s(),t.DNE(10,F,3,1,"p",30),t.k0s(),t.j41(11,"ion-button",31),t.bIt("click",function(n){const o=g.eBV(l).$implicit,i=t.XpG(2);return g.Njj(i.showProjectOptions(o,n))}),t.nrm(12,"ion-icon",32),t.k0s()()}if(2&r){const l=a.$implicit,e=t.XpG(2);t.R7$(5),t.JRh(l.name),t.R7$(3),t.SpI(" ",e.formatDate(l.createdAt)," "),t.R7$(),t.Y8G("ngIf",l.photoCount),t.R7$(),t.Y8G("ngIf",l.location)}}function G(r,a){if(1&r&&(t.j41(0,"ion-list",21),t.DNE(1,R,13,4,"ion-item",22),t.k0s()),2&r){const l=t.XpG();t.R7$(),t.Y8G("ngForOf",l.filteredProjects)}}function w(r,a){if(1&r){const l=t.RV6();t.j41(0,"ion-fab",36)(1,"ion-fab-button",1),t.bIt("click",function(){g.eBV(l);const n=t.XpG();return g.Njj(n.createProject())}),t.nrm(2,"ion-icon",37),t.k0s()()}}const S=[{path:"",component:(()=>{var r;class a{constructor(e,n,o,i,d,j,$,z,X){this.apiService=e,this.storageService=n,this.syncService=o,this.gpsService=i,this.router=d,this.alertCtrl=j,this.toastCtrl=$,this.actionSheetCtrl=z,this.http=X,this.projects=[],this.isLoading=!0,this.isOnline=!0,this.searchQuery=""}ngOnInit(){var e=this;return(0,p.A)(function*(){yield e.loadProjects()})()}ionViewWillEnter(){var e=this;return(0,p.A)(function*(){yield e.loadProjects()})()}loadProjects(){var e=this;return(0,p.A)(function*(){e.isLoading=!0,e.projects=yield e.storageService.getProjects();try{yield(0,_._)(e.apiService.get("/health")),e.isOnline=!0}catch{e.isOnline=!1}e.isLoading=!1})()}doRefresh(e){var n=this;return(0,p.A)(function*(){yield n.loadProjects(),e.target.complete()})()}get filteredProjects(){if(!this.searchQuery.trim())return this.projects;const e=this.searchQuery.toLowerCase();return this.projects.filter(n=>n.name.toLowerCase().includes(e)||n.description?.toLowerCase().includes(e))}createProject(){var e=this;return(0,p.A)(function*(){let n="";try{const i=yield Promise.race([e.gpsService.getCurrentPosition(),new Promise((d,j)=>setTimeout(()=>j(new Error("timeout")),5e3))]);n=yield e.getLocationName(i.latitude,i.longitude)}catch(i){console.log("No se pudo obtener ubicaci\xf3n:",i)}yield(yield e.alertCtrl.create({header:"Nuevo Proyecto",inputs:[{name:"name",type:"text",placeholder:"Nombre *"},{name:"description",type:"textarea",placeholder:"Descripcion"},{name:"location",type:"text",placeholder:"Ubicacion",value:n}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Crear",handler:i=>!!i.name?.trim()&&(e.saveProject(i),!0)}]})).present()})()}getLocationName(e,n){var o=this;return(0,p.A)(function*(){try{const i=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${n}&zoom=18`,d=yield o.http.get(i).toPromise();if(d?.display_name)return d.display_name.split(",").slice(0,3).join(",").trim()}catch(i){console.log("Geocoding error:",i)}return""})()}saveProject(e){var n=this;return(0,p.A)(function*(){try{const o={id:"proj_"+Date.now(),name:e.name.trim(),description:e.description||"",location:e.location||"",photoCount:0,createdAt:new Date,updatedAt:new Date,synced:!1};if(n.isOnline)try{const i=yield(0,_._)(n.apiService.post("/projects",o));i&&(o.id=i.id||o.id,o.synced=!0)}catch(i){console.log("API error, saving locally:",i)}n.projects.unshift(o),yield n.storageService.setProjects(n.projects)}catch(o){console.error("Error creating project:",o)}})()}openProject(e){this.router.navigate(["/project-detail",e.id])}showProjectOptions(e,n){var o=this;return(0,p.A)(function*(){n.stopPropagation(),yield(yield o.actionSheetCtrl.create({header:e.name,buttons:[{text:"Ver",icon:"eye-outline",handler:()=>o.openProject(e)},{text:"Eliminar",icon:"trash-outline",role:"destructive",handler:()=>o.deleteProject(e)},{text:"Cancelar",role:"cancel"}]})).present()})()}deleteProject(e){var n=this;return(0,p.A)(function*(){n.projects=n.projects.filter(o=>o.id!==e.id),yield n.storageService.setProjects(n.projects)})()}formatDate(e){const n="string"==typeof e?new Date(e):e;return n.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})+" - "+n.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}static#t=r=()=>(this.\u0275fac=function(n){return new(n||a)(t.rXU(P.G),t.rXU(v.n),t.rXU(b.H),t.rXU(x.a),t.rXU(C.Ix),t.rXU(c.hG),t.rXU(c.K_),t.rXU(c.GD),t.rXU(M.Qq))},this.\u0275cmp=t.VBU({type:a,selectors:[["app-projects"]],standalone:!1,decls:17,vars:6,consts:[["slot","end"],[3,"click"],["name","add-outline","slot","icon-only"],["placeholder","Buscar proyectos...","debounce","300",3,"ngModelChange","ngModel"],["slot","fixed",3,"ionRefresh"],["class","offline-banner",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","geotech-list",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],[1,"offline-banner"],["name","cloud-offline-outline"],[1,"loading-container"],["name","crescent"],[1,"empty-state"],[1,"empty-icon"],["name","folder-open-outline"],[1,"empty-title"],[1,"empty-description"],[1,"geotech-btn-primary",3,"click"],["name","add-outline","slot","start"],[1,"geotech-list"],["button","","detail","",3,"click",4,"ngFor","ngForOf"],["button","","detail","",3,"click"],["slot","start",1,"project-icon"],["name","folder-outline"],[1,"project-name"],[1,"project-meta"],["name","calendar-outline"],[4,"ngIf"],["class","project-location",4,"ngIf"],["fill","clear","slot","end",3,"click"],["name","ellipsis-vertical","slot","icon-only"],["name","camera-outline"],[1,"project-location"],["name","location-outline"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"]],template:function(n,o){1&n&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Proyectos"),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return o.createProject()}),t.nrm(6,"ion-icon",2),t.k0s()()(),t.j41(7,"ion-toolbar")(8,"ion-searchbar",3),t.mxI("ngModelChange",function(d){return t.DH7(o.searchQuery,d)||(o.searchQuery=d),d}),t.k0s()()(),t.j41(9,"ion-content")(10,"ion-refresher",4),t.bIt("ionRefresh",function(d){return o.doRefresh(d)}),t.nrm(11,"ion-refresher-content"),t.k0s(),t.DNE(12,O,4,0,"div",5)(13,k,4,0,"div",6)(14,I,10,0,"div",7)(15,G,2,1,"ion-list",8),t.k0s(),t.DNE(16,w,3,0,"ion-fab",9)),2&n&&(t.R7$(8),t.R50("ngModel",o.searchQuery),t.R7$(4),t.Y8G("ngIf",!o.isOnline),t.R7$(),t.Y8G("ngIf",o.isLoading),t.R7$(),t.Y8G("ngIf",!o.isLoading&&0===o.filteredProjects.length),t.R7$(),t.Y8G("ngIf",!o.isLoading&&o.filteredProjects.length>0),t.R7$(),t.Y8G("ngIf",!o.isLoading&&o.filteredProjects.length>0))},dependencies:[m.Sq,m.bT,h.BC,h.vS,c.Jm,c.QW,c.W9,c.Q8,c.YW,c.eU,c.iq,c.uz,c.he,c.nf,c.To,c.Ki,c.S1,c.w2,c.BC,c.ai,c.Gw],styles:["ion-searchbar[_ngcontent-%COMP%]{--background: var(--geotech-bg-glass) !important;--color: var(--geotech-text-primary) !important;--placeholder-color: var(--geotech-text-muted) !important;--icon-color: var(--geotech-accent-cyan) !important;--clear-button-color: var(--geotech-text-muted) !important;--border-radius: var(--geotech-radius-md) !important;padding:8px 16px!important}ion-searchbar[_ngcontent-%COMP%]   .searchbar-input[_ngcontent-%COMP%]{color:var(--geotech-text-primary)!important;font-size:14px!important}.offline-banner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px;padding:12px 20px;background:#f59e0b26;border-bottom:1px solid rgba(245,158,11,.3);color:var(--geotech-accent-orange);font-size:13px;font-weight:600}.offline-banner[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;filter:drop-shadow(0 0 4px var(--geotech-accent-orange))}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px}.loading-container[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:48px;height:48px;color:var(--geotech-accent-cyan)}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:20px;color:var(--geotech-text-secondary);font-size:14px;font-weight:500}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:64px 24px;text-align:center}.empty-icon[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;background:var(--geotech-bg-glass);border:1px solid var(--geotech-border-glass);display:flex;align-items:center;justify-content:center;margin-bottom:28px}.empty-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:var(--geotech-text-muted)}.empty-title[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:var(--geotech-text-primary);margin:0 0 10px}.empty-description[_ngcontent-%COMP%]{font-size:15px;color:var(--geotech-text-muted);max-width:300px;margin:0 0 28px;line-height:1.6}ion-list.geotech-list[_ngcontent-%COMP%]{padding:16px;background:transparent}ion-list.geotech-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: var(--geotech-bg-glass);--border-radius: var(--geotech-radius-lg);--padding-start: 16px;--padding-end: 12px;--min-height: 88px;margin-bottom:12px;border:1px solid var(--geotech-border-glass);border-radius:var(--geotech-radius-lg);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);transition:all .3s ease}ion-list.geotech-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:hover{border-color:#00d4ff4d;box-shadow:var(--geotech-glow-cyan)}.project-icon[_ngcontent-%COMP%]{width:52px;height:52px;border-radius:var(--geotech-radius-md);background:#00d4ff26;border:1px solid rgba(0,212,255,.2);display:flex;align-items:center;justify-content:center}.project-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:26px;color:var(--geotech-accent-cyan)}.project-name[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:var(--geotech-text-primary);margin-bottom:6px}.project-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--geotech-text-muted)}.project-meta[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.project-meta[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;margin-left:12px}.project-location[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--geotech-text-secondary);margin-top:6px}.project-location[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px;color:var(--geotech-accent-cyan)}ion-fab-button[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--geotech-accent-cyan), #0099cc);--background-activated: var(--geotech-accent-cyan);--box-shadow: var(--geotech-glow-cyan);color:var(--geotech-bg-dark)}.geotech-btn-primary[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--geotech-accent-cyan), #0099cc);--border-radius: var(--geotech-radius-md);--box-shadow: var(--geotech-glow-cyan);height:52px;font-weight:600;text-transform:none;color:var(--geotech-bg-dark)}ion-list.geotech-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-button[fill=clear][_ngcontent-%COMP%]{--background: transparent !important;--background-hover: transparent !important;--background-focused: transparent !important;--color: var(--geotech-text-muted)}ion-list.geotech-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-button[fill=clear][_ngcontent-%COMP%]:hover{--color: var(--geotech-accent-cyan)}"]}))}return r(),a})()}];let T=(()=>{var r;class a{static#t=r=()=>(this.\u0275fac=function(n){return new(n||a)},this.\u0275mod=t.$C({type:a}),this.\u0275inj=g.G2t({imports:[f.iI.forChild(S),f.iI]}))}return r(),a})(),D=(()=>{var r;class a{static#t=r=()=>(this.\u0275fac=function(n){return new(n||a)},this.\u0275mod=t.$C({type:a}),this.\u0275inj=g.G2t({imports:[m.MD,h.YN,h.X1,c.bv,T]}))}return r(),a})()},4843:(y,u,s)=>{s.d(u,{_:()=>c});var m=s(9350),h=s(7707);function c(f,p){const _="object"==typeof p;return new Promise((t,g)=>{const P=new h.Ms({next:v=>{t(v),P.unsubscribe()},error:g,complete:()=>{_?t(p.defaultValue):g(new m.G)}});f.subscribe(P)})}}}]);