"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9929],{9929:(pt,C,p)=>{p.r(C),p.d(C,{CatastroPageModule:()=>lt});var b=p(2200),x=p(4341),h=p(7343),M=p(8132),m=p(467),g=p(8244),t=p(3664),i=p(2615),w=p(4843),j=p(7673),P=p(2087),I=p(9974),v=p(4360),F=p(3669),L=p(1807),T=p(8750),G=p(9437),y=p(9330),E=p(3366);let R=(()=>{var r;class c{constructor(e,n){this.http=e,this.api=n,this.CATASTRO_URL="https://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCoordenadas.asmx/Consulta_RCCOOR"}getParcelByCoordinates(e,n){var a=this;return(0,m.A)(function*(){try{const s=yield(0,w._)(a.api.get(`/catastro/lookup?lat=${e}&lon=${n}`).pipe((0,P.w)(1e4),function V(r=1/0){let c;c=r&&"object"==typeof r?r:{count:r};const{count:o=1/0,delay:e,resetOnSuccess:n=!1}=c;return o<=0?F.D:(0,I.N)((a,s)=>{let d,l=0;const u=()=>{let f=!1;d=a.subscribe((0,v._)(s,_=>{n&&(l=0),s.next(_)},void 0,_=>{if(l++<o){const k=()=>{d?(d.unsubscribe(),d=null,u()):f=!0};if(null!=e){const dt="number"==typeof e?(0,L.O)(e):(0,T.Tg)(e(_,l)),O=(0,v._)(s,()=>{O.unsubscribe(),k()},()=>{s.complete()});dt.subscribe(O)}else k()}else s.error(_)})),f&&(d.unsubscribe(),d=null,u())};u()})}(1)));if(s.success&&s.catastro)return s.catastro;throw new Error("No se encontraron datos catastrales")}catch(s){throw console.warn("Backend catastro failed:",s?.message||s),new Error("Catastro no disponible. Intenta de nuevo m\xe1s tarde.")}})()}getParcelByReference(e){return(0,m.A)(function*(){return{referenciaCatastral:e,direccion:"Direccion no disponible",municipio:"",provincia:""}})()}lookupByCoordinates(e,n){return this.api.get(`/catastro/lookup?lat=${e}&lon=${n}`).pipe((0,P.w)(1e4),(0,G.W)(a=>(console.error("Error consultando Catastro:",a),(0,j.of)({success:!1,error:"Catastro no disponible"}))))}extractMunicipio(e){const n=e.match(/\.\s*([^(]+)\s*\(/);return n?n[1].trim():""}extractProvincia(e){const n=e.match(/\(([^)]+)\)/);return n?n[1].trim():""}formatReferencia(e){return e.length<14?e:`${e.slice(0,5)} ${e.slice(5,7)} ${e.slice(7,12)} ${e.slice(12,14)} ${e.slice(14)}`}getViewerUrl(e){return`https://www1.sedecatastro.gob.es/Cartografia/mapa.aspx?refcat=${e}`}static#t=r=()=>(this.\u0275fac=function(n){return new(n||c)(i.KVO(y.Qq),i.KVO(E.G))},this.\u0275prov=i.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}))}return r(),c})();var A=p(2092),D=p(7291),S=p(8426),B=p(5032);const $=["kmlFileInput"];function z(r,c){if(1&r){const o=t.RV6();t.j41(0,"div",61),t.bIt("click",function(){const n=i.eBV(o).$implicit,a=t.XpG(3);return i.Njj(a.selectAddress(n))}),t.nrm(1,"ion-icon",62),t.j41(2,"span"),t.EFF(3),t.k0s()()}if(2&r){const o=c.$implicit;t.R7$(3),t.JRh(o.display_name)}}function N(r,c){if(1&r&&(t.j41(0,"div",59),t.DNE(1,z,4,1,"div",60),t.k0s()),2&r){const o=t.XpG(2);t.R7$(),t.Y8G("ngForOf",o.searchResults)}}function X(r,c){if(1&r&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&r){const o=t.XpG(3);t.R7$(),t.SpI("Distancia: ",t.i5U(2,1,o.measureDistance,"1.2-2")," m")}}function U(r,c){if(1&r&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&r){const o=t.XpG(3);t.R7$(),t.SpI("Area: ",t.i5U(2,1,o.measureArea,"1.0-0")," m\xb2")}}function Y(r,c){if(1&r){const o=t.RV6();t.j41(0,"div",63)(1,"div",64),t.nrm(2,"ion-icon",65),t.DNE(3,X,3,4,"span",66)(4,U,3,4,"span",66),t.k0s(),t.j41(5,"button",67),t.bIt("click",function(){i.eBV(o);const n=t.XpG(2);return i.Njj(n.stopMeasure())}),t.nrm(6,"ion-icon",68),t.EFF(7," Guardar "),t.k0s()()}if(2&r){const o=t.XpG(2);t.R7$(2),t.Y8G("name","distance"===o.measureMode?"resize-outline":"square-outline"),t.R7$(),t.Y8G("ngIf","distance"===o.measureMode),t.R7$(),t.Y8G("ngIf","area"===o.measureMode)}}function K(r,c){if(1&r){const o=t.RV6();t.j41(0,"div",71)(1,"div",72),t.nrm(2,"ion-icon",12),t.j41(3,"span"),t.EFF(4),t.k0s()(),t.j41(5,"div",73)(6,"button",74),t.bIt("click",function(){const n=i.eBV(o).index,a=t.XpG(3);return i.Njj(a.zoomToKmlLayer(n))}),t.nrm(7,"ion-icon",75),t.k0s(),t.j41(8,"button",76),t.bIt("click",function(){const n=i.eBV(o).index,a=t.XpG(3);return i.Njj(a.removeKmlLayer(n))}),t.nrm(9,"ion-icon",77),t.k0s()()()}if(2&r){const o=c.$implicit;t.R7$(4),t.JRh(o.name)}}function W(r,c){if(1&r&&(t.j41(0,"div",69),t.DNE(1,K,10,1,"div",70),t.k0s()),2&r){const o=t.XpG(2);t.R7$(),t.Y8G("ngForOf",o.kmlLayers)}}function H(r,c){1&r&&(t.j41(0,"div",78)(1,"p"),t.EFF(2,"No hay capas KML cargadas"),t.k0s()())}function Z(r,c){if(1&r){const o=t.RV6();t.j41(0,"button",79),t.bIt("click",function(){i.eBV(o);const n=t.XpG(2);return i.Njj(n.openInCatastro())}),t.nrm(1,"ion-icon",80),t.j41(2,"span"),t.EFF(3,"Ver en Catastro"),t.k0s()()}}function J(r,c){if(1&r&&(t.j41(0,"div",83)(1,"span",84),t.EFF(2,"Ref. Catastral"),t.k0s(),t.j41(3,"span",85),t.EFF(4),t.k0s()()),2&r){const o=t.XpG(3);t.R7$(4),t.JRh(o.parcelData.referenciaCatastral)}}function Q(r,c){if(1&r&&(t.j41(0,"div",83)(1,"span",84),t.EFF(2,"Direccion"),t.k0s(),t.j41(3,"span",86),t.EFF(4),t.k0s()()),2&r){const o=t.XpG(3);t.R7$(4),t.JRh(o.parcelData.direccion)}}function q(r,c){if(1&r&&(t.j41(0,"div",83)(1,"span",84),t.EFF(2,"Superficie"),t.k0s(),t.j41(3,"span",86),t.EFF(4),t.k0s()()),2&r){const o=t.XpG(3);t.R7$(4),t.SpI("",o.parcelData.superficie," m2")}}function tt(r,c){if(1&r&&(t.j41(0,"div",83)(1,"span",84),t.EFF(2,"Uso"),t.k0s(),t.j41(3,"span",86),t.EFF(4),t.k0s()()),2&r){const o=t.XpG(3);t.R7$(4),t.JRh(o.parcelData.uso)}}function et(r,c){if(1&r&&(t.j41(0,"div",81),t.DNE(1,J,5,1,"div",82)(2,Q,5,1,"div",82)(3,q,5,1,"div",82)(4,tt,5,1,"div",82),t.k0s()),2&r){const o=t.XpG(2);t.R7$(),t.Y8G("ngIf",o.parcelData.referenciaCatastral),t.R7$(),t.Y8G("ngIf",o.parcelData.direccion),t.R7$(),t.Y8G("ngIf",o.parcelData.superficie),t.R7$(),t.Y8G("ngIf",o.parcelData.uso)}}function nt(r,c){if(1&r){const o=t.RV6();t.j41(0,"div",4),t.nrm(1,"div",5),t.j41(2,"div",6)(3,"div",7)(4,"button",8),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.setMapType("satellite"))}),t.nrm(5,"ion-icon",9),t.EFF(6," Satelite "),t.k0s(),t.j41(7,"button",8),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.setMapType("street"))}),t.nrm(8,"ion-icon",10),t.EFF(9," Mapa "),t.k0s()(),t.j41(10,"button",11),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.toggleCatastro())}),t.nrm(11,"ion-icon",12),t.EFF(12," Catastro "),t.k0s()(),t.j41(13,"div",13)(14,"button",14),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.locateMe())}),t.nrm(15,"ion-icon",15),t.k0s(),t.j41(16,"button",16),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.openEarthView())}),t.nrm(17,"ion-icon",17),t.k0s(),t.j41(18,"button",18),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.toggleSearch())}),t.nrm(19,"ion-icon",19),t.k0s(),t.j41(20,"button",20),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.triggerKmlImport())}),t.nrm(21,"ion-icon",21),t.k0s(),t.j41(22,"button",22),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.toggleMeasureDistance())}),t.nrm(23,"ion-icon",23),t.k0s(),t.j41(24,"button",22),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.toggleMeasureArea())}),t.nrm(25,"ion-icon",24),t.k0s()(),t.j41(26,"input",25,0),t.bIt("change",function(n){i.eBV(o);const a=t.XpG();return i.Njj(a.onKmlFileSelected(n))}),t.k0s(),t.j41(28,"div",26)(29,"div",27)(30,"h3"),t.EFF(31,"Buscar ubicacion"),t.k0s(),t.j41(32,"button",8),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.toggleSearch())}),t.nrm(33,"ion-icon",28),t.k0s()(),t.j41(34,"div",29)(35,"div",30)(36,"label"),t.EFF(37,"Buscar direccion"),t.k0s(),t.j41(38,"div",31)(39,"input",32),t.mxI("ngModelChange",function(n){i.eBV(o);const a=t.XpG();return t.DH7(a.searchAddress,n)||(a.searchAddress=n),i.Njj(n)}),t.bIt("keyup.enter",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.searchByAddress())}),t.k0s(),t.j41(40,"button",33),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.searchByAddress())}),t.nrm(41,"ion-icon",19),t.k0s()()(),t.DNE(42,N,2,1,"div",34),t.j41(43,"div",35)(44,"span"),t.EFF(45,"o coordenadas"),t.k0s()(),t.j41(46,"div",30)(47,"label"),t.EFF(48,"Latitud"),t.k0s(),t.j41(49,"input",36),t.mxI("ngModelChange",function(n){i.eBV(o);const a=t.XpG();return t.DH7(a.latitude,n)||(a.latitude=n),i.Njj(n)}),t.k0s()(),t.j41(50,"div",30)(51,"label"),t.EFF(52,"Longitud"),t.k0s(),t.j41(53,"input",37),t.mxI("ngModelChange",function(n){i.eBV(o);const a=t.XpG();return t.DH7(a.longitude,n)||(a.longitude=n),i.Njj(n)}),t.k0s()(),t.j41(54,"button",38),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.goToCoords())}),t.nrm(55,"ion-icon",39),t.EFF(56," Ir a coordenadas "),t.k0s()()(),t.DNE(57,Y,8,3,"div",40),t.j41(58,"button",41),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.goToMeasurements())}),t.nrm(59,"ion-icon",42),t.k0s(),t.j41(60,"div",43)(61,"div",44)(62,"h3"),t.EFF(63,"Capas KML"),t.k0s(),t.j41(64,"button",8),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.toggleKmlPanel())}),t.nrm(65,"ion-icon",28),t.k0s()(),t.DNE(66,W,2,1,"div",45)(67,H,3,0,"div",46),t.j41(68,"button",47),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.triggerKmlImport())}),t.nrm(69,"ion-icon",48),t.EFF(70," Importar KML/KMZ "),t.k0s()(),t.j41(71,"div",49)(72,"div",50)(73,"div",51),t.nrm(74,"ion-icon",52),t.j41(75,"span"),t.EFF(76),t.k0s()(),t.j41(77,"button",8),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.closeInfoPanel())}),t.nrm(78,"ion-icon",28),t.k0s()(),t.j41(79,"div",53)(80,"button",54),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.searchCatastro())}),t.nrm(81,"ion-icon",55),t.j41(82,"span"),t.EFF(83,"Consultar Catastro"),t.k0s()(),t.j41(84,"button",56),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.openInGoogleMaps())}),t.nrm(85,"ion-icon",10),t.j41(86,"span"),t.EFF(87,"Google Maps"),t.k0s()(),t.j41(88,"button",56),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.openInGoogleEarth())}),t.nrm(89,"ion-icon",9),t.j41(90,"span"),t.EFF(91,"Google Earth"),t.k0s()(),t.DNE(92,Z,4,0,"button",57),t.k0s(),t.DNE(93,et,5,4,"div",58),t.k0s()()}if(2&r){const o=t.XpG();t.R7$(4),t.AVh("active","satellite"===o.mapType),t.R7$(3),t.AVh("active","street"===o.mapType),t.R7$(3),t.AVh("active",o.showCatastro),t.R7$(10),t.AVh("active",o.kmlLayers.length>0),t.R7$(2),t.AVh("active","distance"===o.measureMode),t.R7$(2),t.AVh("active","area"===o.measureMode),t.R7$(4),t.AVh("visible",o.showSearch),t.R7$(11),t.R50("ngModel",o.searchAddress),t.R7$(3),t.Y8G("ngIf",o.showAddressResults&&o.searchResults.length>0),t.R7$(7),t.R50("ngModel",o.latitude),t.R7$(4),t.R50("ngModel",o.longitude),t.R7$(4),t.Y8G("ngIf","none"!==o.measureMode),t.R7$(3),t.AVh("visible",o.showKmlPanel),t.R7$(6),t.Y8G("ngIf",o.kmlLayers.length>0),t.R7$(),t.Y8G("ngIf",0===o.kmlLayers.length),t.R7$(4),t.AVh("visible",o.showInfoPanel),t.R7$(5),t.Lme("",o.latitude,", ",o.longitude),t.R7$(16),t.Y8G("ngIf",null==o.parcelData?null:o.parcelData.referenciaCatastral),t.R7$(),t.Y8G("ngIf",o.parcelData)}}function ot(r,c){if(1&r&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&r){const o=t.XpG(3);t.R7$(),t.SpI("Distancia: ",t.i5U(2,1,o.measureDistance,"1.2-2")," m")}}function at(r,c){if(1&r&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&r){const o=t.XpG(3);t.R7$(),t.SpI("Area: ",t.i5U(2,1,o.measureArea,"1.0-0")," m\xb2")}}function it(r,c){if(1&r){const o=t.RV6();t.j41(0,"div",93)(1,"div",64),t.nrm(2,"ion-icon",65),t.DNE(3,ot,3,4,"span",66)(4,at,3,4,"span",66),t.k0s(),t.j41(5,"button",67),t.bIt("click",function(){i.eBV(o);const n=t.XpG(2);return i.Njj(n.stopMeasure())}),t.nrm(6,"ion-icon",68),t.EFF(7," Guardar "),t.k0s()()}if(2&r){const o=t.XpG(2);t.R7$(2),t.Y8G("name","distance"===o.measureMode?"resize-outline":"square-outline"),t.R7$(),t.Y8G("ngIf","distance"===o.measureMode),t.R7$(),t.Y8G("ngIf","area"===o.measureMode)}}function rt(r,c){if(1&r){const o=t.RV6();t.j41(0,"div",87),t.nrm(1,"div",88),t.j41(2,"button",89),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.backToMap())}),t.nrm(3,"ion-icon",90),t.EFF(4," Volver al mapa "),t.k0s(),t.j41(5,"div",91)(6,"button",22),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.toggleMeasureDistance())}),t.nrm(7,"ion-icon",23),t.k0s(),t.j41(8,"button",22),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.toggleMeasureArea())}),t.nrm(9,"ion-icon",24),t.k0s(),t.j41(10,"button",22),t.bIt("click",function(){i.eBV(o);const n=t.XpG();return i.Njj(n.goToMeasurements())}),t.nrm(11,"ion-icon",42),t.k0s()(),t.DNE(12,it,8,3,"div",92),t.k0s()}if(2&r){const o=t.XpG();t.R7$(6),t.AVh("active","distance"===o.measureMode),t.R7$(2),t.AVh("active","area"===o.measureMode),t.R7$(4),t.Y8G("ngIf","none"!==o.measureMode)}}const st=[{path:"",component:(()=>{var r;class c{constructor(e,n,a,s,l,d,u,f){this.catastroService=e,this.gpsService=n,this.storageService=a,this.kmlService=s,this.toastCtrl=l,this.alertCtrl=d,this.navCtrl=u,this.http=f,this.viewMode="map",this.mapType="satellite",this.showCatastro=!0,this.latitude="",this.longitude="",this.parcelData=null,this.showInfoPanel=!1,this.showSearch=!1,this.searchAddress="",this.searchResults=[],this.showAddressResults=!1,this.measureMode="none",this.measurePoints=[],this.measureDistance=0,this.measureArea=0,this.showKmlPanel=!1,this.kmlLayers=[],this.map=null,this.marker=null,this.satelliteLayer=null,this.streetLayer=null,this.catastroLayer=null,this.cesiumViewer=null,this.measureLayer=null,this.measurePolyline=null,this.measurePolygon=null,this.cesiumMeasureEntities=[],this.cesiumMeasureLine=null,this.cesiumMeasurePolygon=null,this.cesiumClickHandler=null,this.Cesium=null,this.hasRequestedLocation=!1}ngOnInit(){this.checkIncomingCoordinates()}ionViewWillEnter(){this.checkIncomingCoordinates()}checkIncomingCoordinates(){const e=localStorage.getItem("geovisor_lat"),n=localStorage.getItem("geovisor_lon"),a=localStorage.getItem("geovisor_mode");if(e&&n&&(this.latitude=e,this.longitude=n,localStorage.removeItem("geovisor_lat"),localStorage.removeItem("geovisor_lon"),localStorage.removeItem("geovisor_mode"),this.map)){const s=parseFloat(e),l=parseFloat(n);this.map.setView([s,l],19),this.addMarker(s,l),"earth"===a&&setTimeout(()=>this.openEarthView(),500)}}ngAfterViewInit(){setTimeout(()=>this.initMap(),400)}ionViewDidEnter(){setTimeout(()=>{this.map&&!this.hasRequestedLocation&&(this.hasRequestedLocation=!0,this.showLocationPrompt())},500)}showLocationPrompt(){var e=this;return(0,m.A)(function*(){yield(yield e.alertCtrl.create({header:"Usar ubicacion actual",message:"\xbfDeseas centrar el mapa en tu ubicacion actual?",buttons:[{text:"No",role:"cancel"},{text:"Si",handler:()=>{e.locateMe()}}]})).present()})()}ngOnDestroy(){this.map&&(this.map.remove(),this.map=null),this.cesiumViewer&&(this.cesiumViewer.destroy(),this.cesiumViewer=null)}initMap(){var e=this;return(0,m.A)(function*(){if(e.map||!document.getElementById("mainMap"))return;delete g.Icon.Default.prototype._getIconUrl,g.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"});let a=parseFloat(e.latitude)||40.416775,s=parseFloat(e.longitude)||-3.70379;e.map=g.map("mainMap",{zoomControl:!1,maxZoom:22,minZoom:3}).setView([a,s],17),e.satelliteLayer=g.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"",maxZoom:22,maxNativeZoom:19}),e.streetLayer=g.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"",maxZoom:22,maxNativeZoom:19}),e.catastroLayer=g.tileLayer.wms("https://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx",{layers:"Catastro",format:"image/png",transparent:!0,attribution:""}),e.satelliteLayer.addTo(e.map),e.showCatastro&&e.catastroLayer.addTo(e.map),g.control.zoom({position:"bottomright"}).addTo(e.map),e.map.on("click",l=>{e.latitude=l.latlng.lat.toFixed(6),e.longitude=l.latlng.lng.toFixed(6),e.addMarker(l.latlng.lat,l.latlng.lng)})})()}setMapType(e){this.map&&(this.mapType=e,this.satelliteLayer&&this.map.removeLayer(this.satelliteLayer),this.streetLayer&&this.map.removeLayer(this.streetLayer),"satellite"===e?this.satelliteLayer?.addTo(this.map):this.streetLayer?.addTo(this.map),this.showCatastro&&this.catastroLayer&&(this.map.removeLayer(this.catastroLayer),this.catastroLayer.addTo(this.map)))}toggleCatastro(){!this.map||!this.catastroLayer||(this.showCatastro=!this.showCatastro,this.showCatastro?this.catastroLayer.addTo(this.map):this.map.removeLayer(this.catastroLayer))}addMarker(e,n){if(!this.map)return;this.marker&&this.map.removeLayer(this.marker);const a=g.divIcon({className:"custom-marker",html:'<div class="marker-dot"></div>',iconSize:[24,24],iconAnchor:[12,12]});this.marker=g.marker([e,n],{icon:a}).addTo(this.map),this.showInfoPanel=!0}locateMe(){var e=this;return(0,m.A)(function*(){try{const n=yield e.gpsService.getCurrentPosition();e.latitude=n.latitude.toFixed(6),e.longitude=n.longitude.toFixed(6),e.map&&(e.map.setView([n.latitude,n.longitude],18),e.addMarker(n.latitude,n.longitude))}catch(n){e.showToast(n.message||"Error GPS","danger")}})()}goToCoords(){if(!this.latitude||!this.longitude)return void this.showToast("Introduce coordenadas","warning");const e=parseFloat(this.latitude),n=parseFloat(this.longitude);this.map&&(this.map.setView([e,n],18),this.addMarker(e,n)),this.showSearch=!1}searchCatastro(){var e=this;return(0,m.A)(function*(){if(e.latitude&&e.longitude)try{e.parcelData=yield e.catastroService.getParcelByCoordinates(parseFloat(e.latitude),parseFloat(e.longitude)),e.parcelData&&(e.showInfoPanel=!0)}catch(n){console.error("Error catastro:",n),e.parcelData=null}else e.showToast("Toca el mapa primero","warning")})()}openEarthView(){var e=this;return(0,m.A)(function*(){e.viewMode="earth",setTimeout((0,m.A)(function*(){try{e.Cesium=yield p.e(789).then(p.bind(p,789));const n=e.Cesium;if(window.CESIUM_BASE_URL="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/",!document.getElementById("cesium-css")){const d=document.createElement("link");d.id="cesium-css",d.rel="stylesheet",d.href="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Widgets/widgets.css",document.head.appendChild(d)}const a=parseFloat(e.latitude)||40.416775,s=parseFloat(e.longitude)||-3.70379;e.cesiumViewer=new n.Viewer("earthView",{terrainProvider:new n.EllipsoidTerrainProvider,baseLayerPicker:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,animation:!1,timeline:!1,fullscreenButton:!1,infoBox:!1,selectionIndicator:!1,creditContainer:document.createElement("div")}),e.cesiumViewer.imageryLayers.addImageryProvider(yield n.ArcGisMapServerImageryProvider.fromUrl("https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer")),e.cesiumViewer.camera.flyTo({destination:n.Cartesian3.fromDegrees(s,a,800),orientation:{heading:0,pitch:n.Math.toRadians(-45),roll:0},duration:2}),e.latitude&&e.longitude&&e.cesiumViewer.entities.add({position:n.Cartesian3.fromDegrees(s,a),point:{pixelSize:16,color:n.Color.fromCssColorString("#ef4444"),outlineColor:n.Color.WHITE,outlineWidth:3},label:{text:"Ubicacion",font:"14px Inter, sans-serif",fillColor:n.Color.WHITE,outlineColor:n.Color.BLACK,outlineWidth:2,style:n.LabelStyle.FILL_AND_OUTLINE,verticalOrigin:n.VerticalOrigin.BOTTOM,pixelOffset:new n.Cartesian2(0,-20)}})}catch(n){console.error("Error cargando Cesium:",n),e.viewMode="map"}}),400)})()}backToMap(){this.cesiumViewer&&(this.cesiumViewer.destroy(),this.cesiumViewer=null),this.viewMode="map",setTimeout(()=>{this.map=null,this.initMap(),setTimeout(()=>{if(this.latitude&&this.longitude&&this.map){const e=parseFloat(this.latitude),n=parseFloat(this.longitude);this.map.setView([e,n],18),this.addMarker(e,n)}},100)},200)}toggleSearch(){this.showSearch=!this.showSearch}closeInfoPanel(){this.showInfoPanel=!1,this.parcelData=null}searchByAddress(){var e=this;return(0,m.A)(function*(){if(e.searchAddress&&!(e.searchAddress.length<3))try{const n=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e.searchAddress)}&countrycodes=es&limit=5`,a=yield e.http.get(n).toPromise();e.searchResults=a||[],e.showAddressResults=e.searchResults.length>0}catch(n){console.error("Search error:",n)}})()}selectAddress(e){const n=parseFloat(e.lat),a=parseFloat(e.lon);this.latitude=n.toFixed(6),this.longitude=a.toFixed(6),this.map&&(this.map.setView([n,a],18),this.addMarker(n,a)),this.showAddressResults=!1,this.showSearch=!1,this.searchAddress="",this.searchResults=[]}toggleMeasureDistance(){"distance"===this.measureMode?this.stopMeasure():this.startMeasure("distance")}toggleMeasureArea(){"area"===this.measureMode?this.stopMeasure():this.startMeasure("area")}startMeasure(e){this.stopMeasure(),this.measureMode=e,this.measurePoints=[],this.measureDistance=0,this.measureArea=0,"map"===this.viewMode&&this.map?(this.measureLayer=g.layerGroup().addTo(this.map),this.map.off("click"),this.map.on("click",n=>this.addMeasurePoint(n.latlng))):"earth"===this.viewMode&&this.cesiumViewer&&this.Cesium&&this.startCesiumMeasure()}startCesiumMeasure(){if(!this.cesiumViewer||!this.Cesium)return;const e=this.Cesium,n=this.cesiumViewer;this.cesiumClickHandler=new e.ScreenSpaceEventHandler(n.scene.canvas),this.cesiumClickHandler.setInputAction(a=>{const s=n.camera.pickEllipsoid(a.position,n.scene.globe.ellipsoid);if(s){const l=e.Cartographic.fromCartesian(s),d=e.Math.toDegrees(l.latitude),u=e.Math.toDegrees(l.longitude);this.addCesiumMeasurePoint(d,u)}},e.ScreenSpaceEventType.LEFT_CLICK)}addCesiumMeasurePoint(e,n){if(!this.cesiumViewer||!this.Cesium)return;const a=this.Cesium,s=this.cesiumViewer;this.measurePoints.push(g.latLng(e,n));const l=s.entities.add({position:a.Cartesian3.fromDegrees(n,e),point:{pixelSize:10,color:a.Color.fromCssColorString("#ef4444"),outlineColor:a.Color.WHITE,outlineWidth:2}});this.cesiumMeasureEntities.push(l),"distance"===this.measureMode&&this.measurePoints.length>=2?(this.updateCesiumLine(),this.measureDistance=this.calculateDistance()):"area"===this.measureMode&&this.measurePoints.length>=3&&(this.updateCesiumPolygon(),this.measureArea=this.calculateArea())}updateCesiumLine(){if(!this.cesiumViewer||!this.Cesium)return;const e=this.Cesium,n=this.cesiumViewer;this.cesiumMeasureLine&&n.entities.remove(this.cesiumMeasureLine);const a=this.measurePoints.map(s=>e.Cartesian3.fromDegrees(s.lng,s.lat));this.cesiumMeasureLine=n.entities.add({polyline:{positions:a,width:3,material:new e.PolylineDashMaterialProperty({color:e.Color.fromCssColorString("#ef4444"),dashLength:16}),clampToGround:!0}})}updateCesiumPolygon(){if(!this.cesiumViewer||!this.Cesium)return;const e=this.Cesium,n=this.cesiumViewer;this.cesiumMeasurePolygon&&n.entities.remove(this.cesiumMeasurePolygon);const a=this.measurePoints.map(s=>e.Cartesian3.fromDegrees(s.lng,s.lat));this.cesiumMeasurePolygon=n.entities.add({polygon:{hierarchy:new e.PolygonHierarchy(a),material:e.Color.fromCssColorString("#3b82f6").withAlpha(.3),outline:!0,outlineColor:e.Color.fromCssColorString("#3b82f6"),outlineWidth:2}})}addMeasurePoint(e){if(!this.map||!this.measureLayer)return;this.measurePoints.push(e);const n=g.divIcon({className:"measure-point",html:'<div class="measure-dot"></div>',iconSize:[12,12],iconAnchor:[6,6]});g.marker(e,{icon:n}).addTo(this.measureLayer),"distance"===this.measureMode&&this.measurePoints.length>=2?(this.measurePolyline&&this.measureLayer.removeLayer(this.measurePolyline),this.measurePolyline=g.polyline(this.measurePoints,{color:"#ef4444",weight:3,dashArray:"10, 5"}).addTo(this.measureLayer),this.measureDistance=this.calculateDistance()):"area"===this.measureMode&&this.measurePoints.length>=3&&(this.measurePolygon&&this.measureLayer.removeLayer(this.measurePolygon),this.measurePolygon=g.polygon(this.measurePoints,{color:"#3b82f6",fillColor:"#3b82f6",fillOpacity:.3}).addTo(this.measureLayer),this.measureArea=this.calculateArea())}calculateDistance(){let e=0;for(let n=1;n<this.measurePoints.length;n++)e+=this.measurePoints[n-1].distanceTo(this.measurePoints[n]);return Math.round(100*e)/100}calculateArea(){if(this.measurePoints.length<3)return 0;const e=this.measurePoints.map(d=>[d.lat,d.lng]);let n=0;for(let d=0;d<e.length;d++){const u=(d+1)%e.length;n+=e[d][1]*e[u][0],n-=e[u][1]*e[d][0]}n=Math.abs(n)/2;const a=e.reduce((d,u)=>d+u[0],0)/e.length,l=111320*Math.cos(a*Math.PI/180);return Math.round(111320*n*l)}stopMeasure(){var e=this;return(0,m.A)(function*(){e.measurePoints.length>=2&&(e.measureDistance>0||e.measureArea>0)&&(yield e.saveMeasurement()),e.measureLayer&&e.map&&e.map.removeLayer(e.measureLayer),e.measureLayer=null,e.measurePolyline=null,e.measurePolygon=null,e.cesiumViewer&&(e.cesiumMeasureEntities.forEach(n=>e.cesiumViewer.entities.remove(n)),e.cesiumMeasureEntities=[],e.cesiumMeasureLine&&(e.cesiumViewer.entities.remove(e.cesiumMeasureLine),e.cesiumMeasureLine=null),e.cesiumMeasurePolygon&&(e.cesiumViewer.entities.remove(e.cesiumMeasurePolygon),e.cesiumMeasurePolygon=null),e.cesiumClickHandler&&(e.cesiumClickHandler.destroy(),e.cesiumClickHandler=null)),e.measureMode="none",e.measurePoints=[],e.measureDistance=0,e.measureArea=0,e.map&&(e.map.off("click"),e.map.on("click",n=>{e.latitude=n.latlng.lat.toFixed(6),e.longitude=n.latlng.lng.toFixed(6),e.addMarker(n.latlng.lat,n.latlng.lng)}))})()}saveMeasurement(){var e=this;return(0,m.A)(function*(){const n=e.measurePoints.map(u=>({lat:u.lat,lng:u.lng})),a=n.reduce((u,f)=>u+f.lat,0)/n.length,s=n.reduce((u,f)=>u+f.lng,0)/n.length;let l="";try{const u=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${s}&zoom=18`,f=yield e.http.get(u).toPromise();f?.display_name&&(l=f.display_name.split(",").slice(0,3).join(","))}catch{l=`${a.toFixed(4)}, ${s.toFixed(4)}`}const d={id:"measure_"+Date.now(),type:e.measureMode,points:n,value:"distance"===e.measureMode?e.measureDistance:e.measureArea,location:l,createdAt:(new Date).toISOString()};yield e.storageService.saveMeasurement(d)})()}goToMeasurements(){this.navCtrl.navigateForward("/tabs/mediciones")}openInGoogleMaps(){if(!this.latitude||!this.longitude)return;this.setMapType("street");const e=parseFloat(this.latitude),n=parseFloat(this.longitude);this.map&&this.map.setView([e,n],19)}openInGoogleEarth(){!this.latitude||!this.longitude||this.openEarthView()}openInCatastro(){if(this.showCatastro||this.toggleCatastro(),this.map&&this.latitude&&this.longitude){const e=parseFloat(this.latitude),n=parseFloat(this.longitude);this.map.setView([e,n],20)}}showToast(e,n){var a=this;return(0,m.A)(function*(){yield(yield a.toastCtrl.create({message:e,duration:2e3,position:"top",color:n})).present()})()}triggerKmlImport(){this.kmlLayers.length>0?this.showKmlPanel=!0:this.kmlFileInput.nativeElement.click()}toggleKmlPanel(){this.showKmlPanel=!this.showKmlPanel}onKmlFileSelected(e){var n=this;return(0,m.A)(function*(){const a=e.target;if(!a.files||0===a.files.length)return;const s=a.files[0];try{const l=yield n.kmlService.readFile(s);n.displayKmlDocument(l),n.showToast(`Capa "${l.name}" cargada`,"success"),n.showKmlPanel=!0}catch(l){console.error("Error loading KML:",l),n.showToast(l.message||"Error al cargar el archivo","danger")}finally{a.value=""}})()}displayKmlDocument(e){if(!this.map)return;const n=g.layerGroup(),a=[];let s;e.placemarks.forEach(l=>{const d=this.createLayerFromPlacemark(l,e.images);d&&(d.addTo(n),l.coordinates.forEach(u=>a.push(g.latLng(u.lat,u.lng))))}),n.addTo(this.map),a.length>0?(s=g.latLngBounds(a),this.map.fitBounds(s,{padding:[50,50]})):s=this.map.getBounds(),this.kmlLayers.push({name:e.name,layerGroup:n,bounds:s,document:e})}createLayerFromPlacemark(e,n){if(0===e.coordinates.length)return null;switch(e.type){case"point":return this.createPointLayer(e,n);case"polygon":return this.createPolygonLayer(e);case"line":return this.createLineLayer(e);default:return null}}createPointLayer(e,n){const a=e.coordinates[0],s=g.divIcon({className:"kml-marker",html:'<div class="kml-marker-dot"></div>',iconSize:[20,20],iconAnchor:[10,10]}),l=g.marker([a.lat,a.lng],{icon:s});let d=`<div class="kml-popup"><strong>${e.name}</strong>`;return e.imageUrl&&(d+=`<br><img src="${e.imageUrl.startsWith("data:")?e.imageUrl:n.get(e.imageUrl)||e.imageUrl}" style="max-width:200px;max-height:150px;margin-top:8px;">`),e.description&&(d+=`<br><span style="color:#666;font-size:12px;">${e.description}</span>`),d+="</div>",l.bindPopup(d,{maxWidth:250}),l}createPolygonLayer(e){const n=e.coordinates.map(s=>g.latLng(s.lat,s.lng)),a=g.polygon(n,{color:"#ff0000",weight:3,fillColor:"#ff0000",fillOpacity:.2});return a.bindPopup(`<strong>${e.name}</strong>${e.description?"<br>"+e.description:""}`),a}createLineLayer(e){const n=e.coordinates.map(s=>g.latLng(s.lat,s.lng)),a=g.polyline(n,{color:"#0066ff",weight:4});return a.bindPopup(`<strong>${e.name}</strong>${e.description?"<br>"+e.description:""}`),a}zoomToKmlLayer(e){this.map&&this.kmlLayers[e]&&this.map.fitBounds(this.kmlLayers[e].bounds,{padding:[50,50]})}removeKmlLayer(e){this.map&&this.kmlLayers[e]&&(this.map.removeLayer(this.kmlLayers[e].layerGroup),this.kmlLayers.splice(e,1),0===this.kmlLayers.length&&(this.showKmlPanel=!1))}static#t=r=()=>(this.\u0275fac=function(n){return new(n||c)(t.rXU(R),t.rXU(A.a),t.rXU(D.n),t.rXU(S.c),t.rXU(h.K_),t.rXU(h.hG),t.rXU(B.q9),t.rXU(y.Qq))},this.\u0275cmp=t.VBU({type:c,selectors:[["app-catastro"]],viewQuery:function(n,a){if(1&n&&t.GBs($,5),2&n){let s;t.mGM(s=t.lsd())&&(a.kmlFileInput=s.first)}},standalone:!1,decls:3,vars:3,consts:[["kmlFileInput",""],[1,"map-content",3,"fullscreen"],["class","map-container",4,"ngIf"],["class","earth-container",4,"ngIf"],[1,"map-container"],["id","mainMap",1,"main-map"],[1,"top-controls"],[1,"map-type-toggle"],[3,"click"],["name","globe-outline"],["name","map-outline"],[1,"catastro-toggle",3,"click"],["name","layers-outline"],[1,"fab-container"],[1,"fab-button","primary",3,"click"],["name","locate"],[1,"fab-button","secondary",3,"click"],["name","earth"],[1,"fab-button","tertiary",3,"click"],["name","search"],[1,"fab-button","kml",3,"click"],["name","folder-outline"],[1,"fab-button",3,"click"],["name","resize-outline"],["name","square-outline"],["type","file","accept",".kml,.kmz",2,"display","none",3,"change"],[1,"search-panel"],[1,"search-header"],["name","close"],[1,"search-form"],[1,"input-group"],[1,"search-input-wrapper"],["type","text","placeholder","Ej: Calle Mayor 1, Madrid",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-icon-btn",3,"click"],["class","address-results",4,"ngIf"],[1,"divider"],["type","text","placeholder","40.416775",3,"ngModelChange","ngModel"],["type","text","placeholder","-3.703790",3,"ngModelChange","ngModel"],[1,"btn-primary",3,"click"],["name","navigate"],["class","measure-panel",4,"ngIf"],[1,"fab-measurements",3,"click"],["name","list-outline"],[1,"kml-panel"],[1,"kml-header"],["class","kml-content",4,"ngIf"],["class","kml-empty",4,"ngIf"],[1,"btn-import",3,"click"],["name","add-circle-outline"],[1,"info-panel"],[1,"info-header"],[1,"coords-display"],["name","location"],[1,"info-actions"],[1,"action-btn",3,"click"],["name","business-outline"],[1,"action-btn","google",3,"click"],["class","action-btn catastro",3,"click",4,"ngIf"],["class","parcel-data",4,"ngIf"],[1,"address-results"],["class","result-item",3,"click",4,"ngFor","ngForOf"],[1,"result-item",3,"click"],["name","location-outline"],[1,"measure-panel"],[1,"measure-info"],[3,"name"],[4,"ngIf"],[1,"measure-stop",3,"click"],["name","checkmark-circle"],[1,"kml-content"],["class","kml-layer",4,"ngFor","ngForOf"],[1,"kml-layer"],[1,"layer-info"],[1,"layer-actions"],["title","Centrar",3,"click"],["name","locate-outline"],["title","Eliminar",3,"click"],["name","trash-outline"],[1,"kml-empty"],[1,"action-btn","catastro",3,"click"],["name","open-outline"],[1,"parcel-data"],["class","data-row",4,"ngIf"],[1,"data-row"],[1,"data-label"],[1,"data-value","mono"],[1,"data-value"],[1,"earth-container"],["id","earthView",1,"earth-view"],[1,"back-btn",3,"click"],["name","arrow-back"],[1,"earth-fab-container"],["class","measure-panel earth-measure",4,"ngIf"],[1,"measure-panel","earth-measure"]],template:function(n,a){1&n&&(t.j41(0,"ion-content",1),t.DNE(1,nt,94,29,"div",2)(2,rt,13,5,"div",3),t.k0s()),2&n&&(t.Y8G("fullscreen",!0),t.R7$(),t.Y8G("ngIf","map"===a.viewMode),t.R7$(),t.Y8G("ngIf","earth"===a.viewMode))},dependencies:[b.Sq,b.bT,x.me,x.BC,x.vS,h.W9,h.iq,b.QX],styles:['.map-content[_ngcontent-%COMP%]{--background: #0a0a0f;font-family:-apple-system,BlinkMacSystemFont,sans-serif}.map-container[_ngcontent-%COMP%], .earth-container[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background:#0a0a0f}.main-map[_ngcontent-%COMP%], .earth-view[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .custom-marker{background:transparent}[_nghost-%COMP%]     .marker-dot{width:20px;height:20px;background:#00d4ff;border:2px solid #f1f5f9;border-radius:50%;box-shadow:0 0 15px #00d4ff,0 0 30px #00d4ff80;animation:_ngcontent-%COMP%_pulse-glow 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse-glow{0%,to{box-shadow:0 0 15px #00d4ff,0 0 30px #00d4ff80}50%{box-shadow:0 0 25px #00d4ff,0 0 50px #00d4ffb3}}.top-controls[_ngcontent-%COMP%]{position:absolute;top:16px;left:16px;right:16px;display:flex;gap:12px;z-index:1000}.map-type-toggle[_ngcontent-%COMP%]{display:flex;background:#1e1e2db3;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:14px;overflow:hidden;box-shadow:0 0 20px #00d4ff4d,0 4px 24px #0006}.map-type-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:12px 18px;border:none;background:transparent;font-size:13px;font-weight:600;color:#94a3b8;cursor:pointer;transition:all .3s ease}.map-type-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.map-type-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#f1f5f9;background:#ffffff0d}.map-type-toggle[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#00d4ff,#0094b3);color:#0a0a0f}.map-type-toggle[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#0a0a0f}.catastro-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:12px 18px;border:none;background:#1e1e2db3;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:14px;font-size:13px;font-weight:600;color:#94a3b8;cursor:pointer;transition:all .3s ease;box-shadow:0 0 20px #7c3aed4d,0 4px 24px #0006}.catastro-toggle[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.catastro-toggle[_ngcontent-%COMP%]:hover{color:#f1f5f9}.catastro-toggle.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#0a7350);color:#0a0a0f;box-shadow:0 0 20px #10b9814d,0 4px 24px #0006}.fab-container[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:100px;display:flex;flex-direction:column;gap:12px;z-index:1000}.fab-button[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:16px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;background:#1e1e2db3;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1)}.fab-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#f1f5f9}.fab-button[_ngcontent-%COMP%]:active{transform:scale(.92)}.fab-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.fab-button.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#00d4ffcc,#00d4ff66);box-shadow:0 0 20px #00d4ff4d,0 4px 24px #0006}.fab-button.primary[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff}.fab-button.secondary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#7c3aedcc,#7c3aed66);box-shadow:0 0 20px #7c3aed4d,0 4px 24px #0006}.fab-button.secondary[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff}.fab-button.tertiary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981cc,#10b98166);box-shadow:0 0 20px #10b9814d,0 4px 24px #0006}.fab-button.tertiary[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff}.search-panel[_ngcontent-%COMP%]{position:absolute;top:80px;left:16px;right:16px;background:#1e1e2db3;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:24px;z-index:1001;box-shadow:0 0 20px #00d4ff4d,0 4px 24px #0006;transform:translateY(-20px);opacity:0;pointer-events:none;transition:all .3s ease}.search-panel.visible[_ngcontent-%COMP%]{transform:translateY(0);opacity:1;pointer-events:all}.search-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.search-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:700;color:#f1f5f9}.search-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:36px;height:36px;border:none;background:#28283c80;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease}.search-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#94a3b8}.search-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#ffffff26}.search-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover   ion-icon[_ngcontent-%COMP%]{color:#f1f5f9}.search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.input-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:11px;font-weight:700;color:#00d4ff;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:14px 18px;border:1px solid rgba(255,255,255,.1);border-radius:12px;font-size:15px;color:#f1f5f9;background:#0000004d;transition:all .3s ease}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#64748b}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#00d4ff;box-shadow:0 0 15px #00d4ff33}.btn-primary[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px;padding:16px;background:linear-gradient(135deg,#00d4ff,#007f99);border:none;border-radius:14px;color:#0a0a0f;font-size:15px;font-weight:700;cursor:pointer;margin-top:8px;transition:all .3s ease;box-shadow:0 0 20px #00d4ff4d,0 4px 24px #0006}.btn-primary[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 0 30px #00d4ff80,0 8px 32px #0006}.info-panel[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;background:#1e1e2db3;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:28px 28px 0 0;padding:24px;z-index:1001;transform:translateY(100%);transition:transform .4s cubic-bezier(.16,1,.3,1)}.info-panel.visible[_ngcontent-%COMP%]{transform:translateY(0)}.info-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid rgba(255,255,255,.1)}.coords-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;font-size:15px;font-weight:600;color:#f1f5f9;font-family:monospace}.coords-display[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px;color:#ef4444;filter:drop-shadow(0 0 6px #ef4444)}.info-header[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{width:36px;height:36px;border:none;background:#28283c80;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease}.info-header[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#94a3b8}.info-header[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:hover{background:#ffffff26}.info-header[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:hover   ion-icon[_ngcontent-%COMP%]{color:#f1f5f9}.info-actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}.action-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:14px;background:#28283c80;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);border-radius:14px;font-size:13px;font-weight:600;color:#94a3b8;cursor:pointer;transition:all .2s ease;border:1px solid transparent}.action-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#00d4ff}.action-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#f1f5f9;border-color:#ffffff1a}.action-btn[_ngcontent-%COMP%]:active{transform:scale(.98)}.action-btn.google[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#10b981}.action-btn.catastro[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#f59e0b}.parcel-data[_ngcontent-%COMP%]{margin-top:16px;background:#28283c80;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:16px;border:1px solid rgba(0,212,255,.2)}.data-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.1)}.data-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.data-label[_ngcontent-%COMP%]{font-size:11px;font-weight:700;color:#64748b;text-transform:uppercase;letter-spacing:.8px}.data-value[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#f1f5f9;text-align:right;max-width:60%}.data-value.mono[_ngcontent-%COMP%]{font-family:monospace;font-size:12px;color:#00d4ff}.back-btn[_ngcontent-%COMP%]{position:absolute;top:16px;left:16px;display:flex;align-items:center;gap:10px;padding:14px 24px;background:#1e1e2db3;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border:none;border-radius:14px;font-size:14px;font-weight:600;color:#f1f5f9;cursor:pointer;z-index:1000;transition:all .3s ease;box-shadow:0 0 20px #7c3aed4d,0 4px 24px #0006}.back-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.back-btn[_ngcontent-%COMP%]:hover{transform:translate(-4px);background:#ffffff26}[_nghost-%COMP%]     .leaflet-control-attribution{display:none}.search-input-wrapper[_ngcontent-%COMP%]{display:flex;gap:8px}.search-input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1}.search-input-wrapper[_ngcontent-%COMP%]   .search-icon-btn[_ngcontent-%COMP%]{width:48px;height:48px;border:none;background:linear-gradient(135deg,#00d4ff,#0094b3);border-radius:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease}.search-input-wrapper[_ngcontent-%COMP%]   .search-icon-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#0a0a0f}.search-input-wrapper[_ngcontent-%COMP%]   .search-icon-btn[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.address-results[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;background:#28283c80;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);border-radius:12px;margin-top:8px}.address-results[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:14px 16px;cursor:pointer;border-bottom:1px solid rgba(255,255,255,.1);transition:all .2s ease}.address-results[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.address-results[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]:hover{background:#ffffff1a}.address-results[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;color:#00d4ff;flex-shrink:0}.address-results[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;color:#f1f5f9;line-height:1.4}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin:16px 0}.divider[_ngcontent-%COMP%]:before, .divider[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:#ffffff1a}.divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:1px}.measure-panel[_ngcontent-%COMP%]{position:absolute;top:80px;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:16px;padding:14px 20px;background:#1e1e2db3;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:16px;z-index:1001;box-shadow:0 0 20px #7c3aed4d,0 4px 24px #0006}.measure-panel[_ngcontent-%COMP%]   .measure-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.measure-panel[_ngcontent-%COMP%]   .measure-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px;color:#00d4ff}.measure-panel[_ngcontent-%COMP%]   .measure-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:#f1f5f9;font-family:monospace}.measure-panel[_ngcontent-%COMP%]   .measure-stop[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:10px 16px;border:none;background:#10b9814d;border-radius:10px;font-size:13px;font-weight:600;color:#10b981;cursor:pointer;transition:all .2s ease}.measure-panel[_ngcontent-%COMP%]   .measure-stop[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.measure-panel[_ngcontent-%COMP%]   .measure-stop[_ngcontent-%COMP%]:hover{background:#10b98180}.fab-measurements[_ngcontent-%COMP%]{position:absolute;left:16px;bottom:100px;width:48px;height:48px;border-radius:14px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;background:#1e1e2db3;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);box-shadow:0 0 20px #f59e0b4d,0 4px 24px #0006;z-index:1000}.fab-measurements[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px;color:#f59e0b}.fab-measurements[_ngcontent-%COMP%]:hover{transform:translateY(-2px);background:#f59e0b33}.fab-measurements[_ngcontent-%COMP%]:active{transform:scale(.92)}[_nghost-%COMP%]     .measure-point{background:transparent}[_nghost-%COMP%]     .measure-dot{width:12px;height:12px;background:#ef4444;border:2px solid white;border-radius:50%;box-shadow:0 0 8px #ef4444cc}.fab-button.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#cc7000)!important;box-shadow:0 0 20px #f59e0b4d,0 4px 24px #0006}.earth-fab-container[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:100px;display:flex;flex-direction:column;gap:12px;z-index:1000}.earth-measure[_ngcontent-%COMP%]{position:absolute;top:80px;left:50%;transform:translate(-50%)}.kml-panel[_ngcontent-%COMP%]{position:absolute;left:16px;bottom:160px;width:280px;max-height:350px;background:#1e1e2db3;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;z-index:1002;transform:translate(-120%);transition:transform .3s ease;box-shadow:0 0 20px #7c3aed4d,0 4px 24px #0006;overflow:hidden}.kml-panel.visible[_ngcontent-%COMP%]{transform:translate(0)}.kml-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid rgba(255,255,255,.1)}.kml-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:700;color:#f1f5f9}.kml-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;border:none;background:#ffffff1a;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer}.kml-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;color:#94a3b8}.kml-content[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;padding:8px}.kml-layer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px;background:#ffffff0d;border-radius:12px;margin-bottom:8px}.kml-layer[_ngcontent-%COMP%]:last-child{margin-bottom:0}.layer-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex:1;overflow:hidden}.layer-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#00d4ff;flex-shrink:0}.layer-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;color:#f1f5f9;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.layer-actions[_ngcontent-%COMP%]{display:flex;gap:6px}.layer-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;border:none;background:#ffffff1a;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease}.layer-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;color:#94a3b8}.layer-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#fff3}.layer-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child:hover{background:#ef44444d}.layer-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child:hover   ion-icon[_ngcontent-%COMP%]{color:#ef4444}.kml-empty[_ngcontent-%COMP%]{padding:24px 16px;text-align:center}.kml-empty[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#64748b}.btn-import[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;width:calc(100% - 32px);margin:16px;padding:14px;border:none;background:linear-gradient(135deg,#00d4ff,#0094b3);border-radius:12px;font-size:14px;font-weight:600;color:#0a0a0f;cursor:pointer;transition:all .2s ease}.btn-import[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.btn-import[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.fab-button.kml.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#7c3aed,#5512c8)!important;box-shadow:0 0 20px #7c3aed4d,0 4px 24px #0006}[_nghost-%COMP%]     .kml-marker{background:transparent}[_nghost-%COMP%]     .kml-marker-dot{width:16px;height:16px;background:#f59e0b;border:3px solid white;border-radius:50%;box-shadow:0 0 10px #f59e0bcc}[_nghost-%COMP%]     .kml-popup{font-family:-apple-system,BlinkMacSystemFont,sans-serif}[_nghost-%COMP%]     .kml-popup strong{color:#1a1a2e;font-size:14px}[_nghost-%COMP%]     .kml-popup img{border-radius:8px;margin-top:8px}']}))}return r(),c})()}];let ct=(()=>{var r;class c{static#t=r=()=>(this.\u0275fac=function(n){return new(n||c)},this.\u0275mod=t.$C({type:c}),this.\u0275inj=i.G2t({imports:[M.iI.forChild(st),M.iI]}))}return r(),c})(),lt=(()=>{var r;class c{static#t=r=()=>(this.\u0275fac=function(n){return new(n||c)},this.\u0275mod=t.$C({type:c}),this.\u0275inj=i.G2t({imports:[b.MD,x.YN,h.bv,ct]}))}return r(),c})()}}]);