"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[989],{989:(ve,M,h)=>{h.r(M),h.d(M,{ProjectDetailPageModule:()=>ue});var w=h(2200),D=h(4341),P=h(7343),O=h(8132),f=h(467),k=h(4843),j=h(8244),e=h(3664),s=h(2615),z=h(2704),T=h(7291),G=h(8426),V=h(6382),$=h(772),B=h(3366),S=h(345),I=h(5032);function N(i,l){if(1&i&&(e.j41(0,"p",26),e.EFF(1),e.k0s()),2&i){const n=e.XpG(2);e.R7$(),e.JRh(n.project.description)}}function A(i,l){1&i&&(e.j41(0,"span",27),e.nrm(1,"ion-icon",28),e.EFF(2," Sincronizado con servidor "),e.k0s())}function X(i,l){1&i&&(e.j41(0,"span",29),e.nrm(1,"ion-icon",30),e.EFF(2," Guardado localmente "),e.k0s())}function K(i,l){if(1&i){const n=e.RV6();e.j41(0,"div",11)(1,"div",12)(2,"h2",13),e.EFF(3),e.k0s(),e.DNE(4,N,2,1,"p",14),e.j41(5,"div",15),e.nrm(6,"ion-icon",16),e.j41(7,"span"),e.EFF(8),e.k0s()(),e.j41(9,"div",15),e.nrm(10,"ion-icon",17),e.j41(11,"span"),e.EFF(12),e.k0s()(),e.j41(13,"div",15),e.nrm(14,"ion-icon",18),e.j41(15,"span"),e.EFF(16),e.k0s()(),e.j41(17,"div",15),e.nrm(18,"ion-icon",19),e.j41(19,"span"),e.EFF(20),e.k0s()(),e.j41(21,"div",15),e.nrm(22,"ion-icon",20),e.j41(23,"span"),e.EFF(24),e.k0s()(),e.j41(25,"div",21),e.DNE(26,A,3,0,"span",22)(27,X,3,0,"span",23),e.k0s(),e.j41(28,"ion-button",24),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.openMapEditor())}),e.nrm(29,"ion-icon",25),e.EFF(30," Editar en Mapa "),e.k0s()()()}if(2&i){const n=e.XpG();e.R7$(3),e.JRh(n.project.name),e.R7$(),e.Y8G("ngIf",n.project.description),e.R7$(4),e.JRh(n.project.location||"Sin ubicacion"),e.R7$(4),e.SpI("Creado: ",n.formatDateTime(n.project.createdAt)),e.R7$(4),e.Lme("",n.photos.length," ",1===n.photos.length?"fotograf\xeda":"fotograf\xedas"),e.R7$(4),e.ZXR("",n.zoneCount," ",1===n.zoneCount?"\xe1rea delimitada":"\xe1reas delimitadas",", ",n.pathCount," ",1===n.pathCount?"trazado vial":"trazados viales",", ",n.markerCount," ",1===n.markerCount?"punto de inter\xe9s":"puntos de inter\xe9s"),e.R7$(4),e.Lme("",n.totalDocuments," ",1===n.totalDocuments?"documento generado":"documentos generados"),e.R7$(2),e.Y8G("ngIf",n.project.synced||n.project.serverId),e.R7$(),e.Y8G("ngIf",!n.project.synced&&!n.project.serverId)}}function U(i,l){if(1&i){const n=e.RV6();e.j41(0,"img",44),e.bIt("error",function(o){s.eBV(n);const r=e.XpG(3);return s.Njj(r.onImageError(o))}),e.k0s()}if(2&i){const n=e.XpG().$implicit;e.Y8G("src",n.imageUrl||n.localPath||n.imagePath,e.B4B)}}function L(i,l){1&i&&(e.j41(0,"div",45),e.nrm(1,"ion-icon",46),e.k0s())}function Y(i,l){if(1&i&&(e.j41(0,"span",47),e.EFF(1),e.k0s()),2&i){const n=e.XpG().$implicit,t=e.XpG(2);e.R7$(),e.JRh(t.formatDate(n.timestamp))}}function J(i,l){if(1&i&&(e.j41(0,"span",48),e.EFF(1),e.k0s()),2&i){const n=e.XpG().$implicit;e.R7$(),e.Lme(" ",n.latitude.toFixed(4),", ",n.longitude.toFixed(4)," ")}}function H(i,l){1&i&&e.nrm(0,"ion-icon",49)}function W(i,l){1&i&&e.nrm(0,"ion-icon",50)}function Z(i,l){if(1&i){const n=e.RV6();e.j41(0,"div",35),e.bIt("click",function(){const o=s.eBV(n).$implicit,r=e.XpG(2);return s.Njj(r.openPhotoViewer(o))}),e.DNE(1,U,1,1,"img",36)(2,L,2,0,"div",37),e.j41(3,"div",38),e.DNE(4,Y,2,1,"span",39)(5,J,2,2,"span",40),e.k0s(),e.j41(6,"div",41),e.DNE(7,H,1,0,"ion-icon",42)(8,W,1,0,"ion-icon",43),e.k0s()()}if(2&i){const n=l.$implicit;e.R7$(),e.Y8G("ngIf",n.imageUrl||n.localPath||n.imagePath),e.R7$(),e.Y8G("ngIf",!n.imageUrl&&!n.localPath&&!n.imagePath),e.R7$(2),e.Y8G("ngIf",n.timestamp),e.R7$(),e.Y8G("ngIf",n.latitude),e.R7$(2),e.Y8G("ngIf",n.aiDescription),e.R7$(),e.Y8G("ngIf",n.notes)}}function Q(i,l){if(1&i&&(e.j41(0,"div",31)(1,"h3",32),e.EFF(2,"Registro fotogr\xe1fico"),e.k0s(),e.j41(3,"div",33),e.DNE(4,Z,9,6,"div",34),e.k0s()()),2&i){const n=e.XpG();e.R7$(4),e.Y8G("ngForOf",n.photos)}}function q(i,l){1&i&&(e.j41(0,"div",51)(1,"div",52),e.nrm(2,"ion-icon",18),e.j41(3,"span"),e.EFF(4,"Sin registro fotogr\xe1fico"),e.k0s()()())}function ee(i,l){if(1&i){const n=e.RV6();e.j41(0,"div",57),e.bIt("click",function(){const o=s.eBV(n).$implicit,r=e.XpG(2);return s.Njj(r.openReportViewer(o))}),e.j41(1,"div",58),e.nrm(2,"ion-icon",59),e.k0s(),e.j41(3,"div",60),e.EFF(4,"INFORME T\xc9CNICO"),e.k0s(),e.j41(5,"div",61),e.EFF(6),e.k0s(),e.j41(7,"div",62),e.EFF(8),e.k0s()()}if(2&i){const n=l.$implicit,t=e.XpG(2);e.R7$(6),e.JRh(n.name),e.R7$(2),e.JRh(t.formatDate(n.createdAt))}}function te(i,l){if(1&i){const n=e.RV6();e.j41(0,"div",63),e.bIt("click",function(){const o=s.eBV(n).$implicit,r=e.XpG(2);return s.Njj(r.openKmlViewer(o))}),e.j41(1,"div",58),e.nrm(2,"ion-icon",64),e.k0s(),e.j41(3,"div",60),e.EFF(4,"GEODATOS KML"),e.k0s(),e.j41(5,"div",61),e.EFF(6),e.k0s(),e.j41(7,"div",62),e.EFF(8),e.k0s()()}if(2&i){const n=l.$implicit,t=e.XpG(2);e.R7$(6),e.JRh(n.name),e.R7$(2),e.JRh(t.formatDate(n.createdAt))}}function oe(i,l){if(1&i&&(e.j41(0,"div",53)(1,"h3",32),e.EFF(2,"Documentaci\xf3n t\xe9cnica"),e.k0s(),e.j41(3,"div",54),e.DNE(4,ee,9,2,"div",55)(5,te,9,2,"div",56),e.k0s()()),2&i){const n=e.XpG();e.R7$(4),e.Y8G("ngForOf",null==n.project?null:n.project.reports),e.R7$(),e.Y8G("ngForOf",null==n.project?null:n.project.kmls)}}function ne(i,l){if(1&i&&(e.j41(0,"div",83)(1,"div",84),e.nrm(2,"ion-icon",85),e.j41(3,"span"),e.EFF(4,"Ubicaci\xf3n"),e.k0s()(),e.j41(5,"p",86),e.EFF(6),e.k0s()()),2&i){const n=e.XpG(2);e.R7$(6),e.JRh(n.selectedPhoto.location)}}function ie(i,l){if(1&i&&(e.j41(0,"div",87)(1,"div",84),e.nrm(2,"ion-icon",88),e.j41(3,"span"),e.EFF(4,"Coordenadas"),e.k0s()(),e.j41(5,"p",89),e.EFF(6),e.k0s()()),2&i){const n=e.XpG(2);e.R7$(6),e.Lme("",n.selectedPhoto.latitude.toFixed(6),", ",n.selectedPhoto.longitude.toFixed(6))}}function re(i,l){if(1&i){const n=e.RV6();e.j41(0,"div",90),e.bIt("click",function(){s.eBV(n);const o=e.XpG(2);return s.Njj(o.editAIDescription())}),e.j41(1,"div",84),e.nrm(2,"ion-icon",91),e.j41(3,"span"),e.EFF(4,"Descripci\xf3n IA"),e.k0s(),e.nrm(5,"ion-icon",92),e.k0s(),e.j41(6,"p",86),e.EFF(7),e.k0s()()}if(2&i){const n=e.XpG(2);e.R7$(7),e.JRh(n.selectedPhoto.aiDescription)}}function ce(i,l){if(1&i){const n=e.RV6();e.j41(0,"div",93),e.bIt("click",function(){s.eBV(n);const o=e.XpG(2);return s.Njj(o.editPhotoNotes())}),e.j41(1,"div",84),e.nrm(2,"ion-icon",59),e.j41(3,"span"),e.EFF(4,"Mis notas"),e.k0s(),e.nrm(5,"ion-icon",92),e.k0s(),e.j41(6,"p",86),e.EFF(7),e.k0s()()}if(2&i){const n=e.XpG(2);e.R7$(7),e.JRh(n.selectedPhoto.notes)}}function ae(i,l){if(1&i&&(e.j41(0,"div",94),e.EFF(1),e.k0s()),2&i){const n=e.XpG(2);e.R7$(),e.SpI(" ",n.formatDateTime(n.selectedPhoto.timestamp)," ")}}function se(i,l){if(1&i){const n=e.RV6();e.j41(0,"button",95),e.bIt("click",function(){s.eBV(n);const o=e.XpG(2);return s.Njj(o.analyzePhotoWithAI())}),e.nrm(1,"ion-icon",96),e.EFF(2," Documentar con IA "),e.k0s()}}function le(i,l){if(1&i){const n=e.RV6();e.j41(0,"button",95),e.bIt("click",function(){s.eBV(n);const o=e.XpG(2);return s.Njj(o.editAIDescription())}),e.nrm(1,"ion-icon",96),e.EFF(2," Editar descripci\xf3n IA "),e.k0s()}}function pe(i,l){1&i&&(e.j41(0,"button",97),e.nrm(1,"ion-spinner",98),e.EFF(2," Analizando... "),e.k0s())}function de(i,l){if(1&i){const n=e.RV6();e.j41(0,"div",65),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.closePhotoViewer())}),e.j41(1,"div",66),e.bIt("click",function(o){return s.eBV(n),s.Njj(o.stopPropagation())}),e.j41(2,"button",67),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.closePhotoViewer())}),e.nrm(3,"ion-icon",68),e.k0s(),e.j41(4,"div",69)(5,"img",44),e.bIt("error",function(o){s.eBV(n);const r=e.XpG();return s.Njj(r.onImageError(o))}),e.k0s()(),e.j41(6,"div",70),e.DNE(7,ne,7,1,"div",71)(8,ie,7,2,"div",72)(9,re,8,1,"div",73)(10,ce,8,1,"div",74)(11,ae,2,1,"div",75),e.j41(12,"div",76)(13,"button",77),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.editPhotoNotes())}),e.nrm(14,"ion-icon",78),e.EFF(15),e.k0s(),e.DNE(16,se,3,0,"button",79)(17,le,3,0,"button",79)(18,pe,3,0,"button",80),e.k0s(),e.j41(19,"button",81),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.confirmDeletePhoto())}),e.nrm(20,"ion-icon",82),e.EFF(21," Eliminar foto "),e.k0s()()()()}if(2&i){const n=e.XpG();e.R7$(5),e.Y8G("src",n.selectedPhoto.imageUrl||n.selectedPhoto.localPath||n.selectedPhoto.imagePath,e.B4B),e.R7$(2),e.Y8G("ngIf",n.selectedPhoto.location),e.R7$(),e.Y8G("ngIf",n.selectedPhoto.latitude),e.R7$(),e.Y8G("ngIf",n.selectedPhoto.aiDescription),e.R7$(),e.Y8G("ngIf",n.selectedPhoto.notes),e.R7$(),e.Y8G("ngIf",n.selectedPhoto.timestamp),e.R7$(4),e.SpI(" ",n.selectedPhoto.notes?"Editar nota":"A\xf1adir nota"," "),e.R7$(),e.Y8G("ngIf",!n.selectedPhoto.aiDescription&&!n.isAnalyzingPhoto),e.R7$(),e.Y8G("ngIf",n.selectedPhoto.aiDescription&&!n.isAnalyzingPhoto),e.R7$(),e.Y8G("ngIf",n.isAnalyzingPhoto)}}function ge(i,l){if(1&i){const n=e.RV6();e.j41(0,"div",99)(1,"div",100)(2,"ion-button",101),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.closeReportViewer())}),e.nrm(3,"ion-icon",102),e.k0s(),e.j41(4,"h2"),e.EFF(5),e.k0s(),e.nrm(6,"div",103),e.k0s(),e.nrm(7,"div",104),e.j41(8,"div",105)(9,"ion-button",106),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.deleteReport(o.selectedReport))}),e.nrm(10,"ion-icon",107),e.EFF(11," Eliminar "),e.k0s(),e.j41(12,"ion-button",108),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.downloadReportAsWord(o.selectedReport))}),e.nrm(13,"ion-icon",109),e.EFF(14," Descargar "),e.k0s()()()}if(2&i){const n=e.XpG();e.R7$(5),e.JRh(n.selectedReport.name),e.R7$(2),e.Y8G("innerHTML",n.selectedReportHtml,e.npT)}}function me(i,l){if(1&i){const n=e.RV6();e.j41(0,"div",110)(1,"div",111)(2,"ion-button",101),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.closeKmlViewer())}),e.nrm(3,"ion-icon",102),e.k0s(),e.j41(4,"h2"),e.EFF(5),e.k0s(),e.nrm(6,"div",103),e.k0s(),e.j41(7,"div",112),e.nrm(8,"div",113),e.k0s(),e.j41(9,"div",114)(10,"ion-button",106),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.deleteKml(o.selectedKml))}),e.nrm(11,"ion-icon",107),e.EFF(12," Eliminar "),e.k0s(),e.j41(13,"ion-button",108),e.bIt("click",function(){s.eBV(n);const o=e.XpG();return s.Njj(o.downloadKml(o.selectedKml))}),e.nrm(14,"ion-icon",109),e.EFF(15," Descargar KML "),e.k0s()()()}if(2&i){const n=e.XpG();e.R7$(5),e.JRh(n.selectedKml.name)}}const he=[{path:"",component:(()=>{var i;class l{constructor(t,o,r,c,a,p,d,g,m,y){this.route=t,this.storageService=o,this.kmlService=r,this.reportService=c,this.claudeService=a,this.apiService=p,this.sanitizer=d,this.navCtrl=g,this.alertCtrl=m,this.platform=y,this.project=null,this.photos=[],this.projectId=null,this.backButtonSub=null,this.selectedPhoto=null,this.showPhotoViewer=!1,this.selectedReport=null,this.selectedReportHtml="",this.showReportViewer=!1,this.selectedKml=null,this.showKmlViewer=!1,this.kmlMap=null,this.isAnalyzingPhoto=!1}ngOnInit(){var t=this;return(0,f.A)(function*(){t.projectId=t.route.snapshot.paramMap.get("id"),t.projectId&&(yield t.loadProject(t.projectId))})()}ionViewWillEnter(){var t=this;return(0,f.A)(function*(){t.projectId&&(yield t.loadProject(t.projectId)),t.backButtonSub=t.platform.backButton.subscribeWithPriority(10,()=>{t.handleBackButton()})})()}ionViewWillLeave(){this.backButtonSub&&(this.backButtonSub.unsubscribe(),this.backButtonSub=null)}ngOnDestroy(){this.backButtonSub&&this.backButtonSub.unsubscribe()}handleBackButton(){this.showPhotoViewer?this.closePhotoViewer():this.showReportViewer?this.closeReportViewer():this.showKmlViewer?this.closeKmlViewer():this.goBack()}loadProject(t){var o=this;return(0,f.A)(function*(){const r=yield o.storageService.getProjects();if(o.project=r.find(c=>c.id===t)||null,o.project){const c=yield o.storageService.getPhotos();o.photos=c.filter(a=>a.projectId===t),o.project.serverId&&(yield o.syncProjectContent(),yield o.syncPhotosFromCloud(),yield o.syncDocumentsFromCloud())}})()}syncProjectContent(){var t=this;return(0,f.A)(function*(){if(t.project?.serverId)try{const o=yield(0,k._)(t.apiService.get(`/projects/${t.project.serverId}`));if(o?.project){const r=o.project,c=r.content||{};new Date(r.updatedAt||0).getTime()>new Date(t.project.updatedAt||0).getTime()&&(c.zones&&(t.project.zones=c.zones),c.paths&&(t.project.paths=c.paths),c.markers&&(t.project.markers=c.markers),c.coordinates&&(t.project.coordinates=c.coordinates),t.project.updatedAt=new Date(r.updatedAt),yield t.storageService.saveProject(t.project),console.log("Contenido del proyecto actualizado desde servidor"))}}catch(o){console.log("Error sincronizando contenido:",o?.message)}})()}syncPhotosFromCloud(){var t=this;return(0,f.A)(function*(){if(t.project?.serverId)try{const o=yield(0,k._)(t.apiService.getPhotosByProject(t.project.serverId));if(o?.photos&&Array.isArray(o.photos)){const r=o.photos;console.log("Fotos en servidor:",r.length);const c=new Map;t.photos.forEach(p=>{p.serverId&&c.set(p.serverId,p)});let a=!1;for(const p of r)if(!c.has(p.id)){const d={id:`photo_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,serverId:p.id,projectId:t.project.id,imageUrl:p.imageUrl,thumbnailUrl:p.thumbnailUrl,latitude:parseFloat(p.latitude)||0,longitude:parseFloat(p.longitude)||0,altitude:p.altitude?parseFloat(p.altitude):void 0,notes:p.notes,aiDescription:p.aiDescription,timestamp:p.createdAt,synced:!0};yield t.storageService.savePhoto(d),t.photos.push(d),c.set(p.id,d),a=!0,console.log("Foto descargada del servidor:",p.id)}if(t.project.markers&&a){let p=!1;for(const d of t.project.markers)if(d.serverPhotoIds&&d.serverPhotoIds.length>0){const g=new Set(d.photoIds||[]);for(const m of d.serverPhotoIds){const y=c.get(m);y&&!g.has(y.id)&&(g.add(y.id),p=!0)}p&&(d.photoIds=Array.from(g))}p&&(yield t.storageService.saveProject(t.project))}}}catch(o){console.log("Error sincronizando fotos:",o?.message)}})()}syncDocumentsFromCloud(){var t=this;return(0,f.A)(function*(){if(t.project?.serverId)try{const o=yield(0,k._)(t.apiService.getReportsByProject(t.project.serverId));if(o?.reports&&Array.isArray(o.reports)){const c=o.reports,a=t.project.reports||[],p=new Set(a.map(g=>g.id));let d=!1;for(const g of c)if(!p.has(g.id))try{const m=yield(0,k._)(t.apiService.getReport(g.id));m?.report&&(a.push({id:m.report.id,name:m.report.name,htmlContent:m.report.htmlContent,createdAt:m.report.createdAt}),d=!0,console.log("Informe sincronizado desde servidor:",g.name))}catch{console.log("Error obteniendo informe:",g.id)}d&&(t.project.reports=a,yield t.storageService.saveProject(t.project))}const r=yield(0,k._)(t.apiService.getKmlsByProject(t.project.serverId));if(r?.kmlFiles&&Array.isArray(r.kmlFiles)){const c=r.kmlFiles,a=t.project.kmls||[],p=new Set(a.map(g=>g.id));let d=!1;for(const g of c)if(!p.has(g.id))try{const m=yield(0,k._)(t.apiService.getKml(g.id));m?.kml&&(a.push({id:m.kml.id,name:m.kml.name,kmlContent:m.kml.kmlContent,createdAt:m.kml.createdAt}),d=!0,console.log("KML sincronizado desde servidor:",g.name))}catch{console.log("Error obteniendo KML:",g.id)}d&&(t.project.kmls=a,yield t.storageService.saveProject(t.project))}}catch(o){console.log("Error sincronizando documentos:",o?.message)}})()}goBack(){this.navCtrl.navigateBack("/tabs/projects")}openMapEditor(){this.project&&this.navCtrl.navigateForward(`/project-editor/${this.project.id}`)}formatDate(t){const o=new Date(t);return o.toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})+" "+o.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}formatDateTime(t){const o=new Date(t);return o.toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})+" - "+o.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}openPhotoViewer(t){this.selectedPhoto=t,this.showPhotoViewer=!0}closePhotoViewer(){this.showPhotoViewer=!1,this.selectedPhoto=null}confirmDeletePhoto(){var t=this;return(0,f.A)(function*(){var r;t.selectedPhoto&&(yield(yield t.alertCtrl.create({header:"Eliminar foto",message:"\xbfEst\xe1s seguro de que quieres eliminar esta foto? Esta acci\xf3n no se puede deshacer.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:(r=(0,f.A)(function*(){yield t.deletePhoto()}),function(){return r.apply(this,arguments)})}]})).present())})()}deletePhoto(){var t=this;return(0,f.A)(function*(){if(t.selectedPhoto&&t.project)try{const o=t.selectedPhoto.id;if(yield t.storageService.deletePhoto(o),t.project.markers&&t.project.markers.length>0){let r=!1;for(const c of t.project.markers)c.photoIds&&c.photoIds.includes(o)&&(c.photoIds=c.photoIds.filter(a=>a!==o),c.serverPhotoIds&&c.photoIds.indexOf(o),r=!0);r&&(yield t.storageService.saveProject(t.project))}t.photos=t.photos.filter(r=>r.id!==o),t.closePhotoViewer()}catch(o){console.error("Error eliminando foto:",o)}})()}editPhotoNotes(){var t=this;return(0,f.A)(function*(){var r;t.selectedPhoto&&(yield(yield t.alertCtrl.create({header:"Editar notas",inputs:[{name:"notes",type:"textarea",placeholder:"Escribe tus notas aqu\xed...",value:t.selectedPhoto.notes||""}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Guardar",handler:(r=(0,f.A)(function*(c){if(t.selectedPhoto){t.selectedPhoto.notes=c.notes,yield t.storageService.updatePhoto(t.selectedPhoto);const a=t.photos.findIndex(p=>p.id===t.selectedPhoto.id);a>=0&&(t.photos[a]={...t.selectedPhoto})}}),function(a){return r.apply(this,arguments)})}]})).present())})()}editAIDescription(){var t=this;return(0,f.A)(function*(){var r;t.selectedPhoto&&(yield(yield t.alertCtrl.create({header:"Editar descripci\xf3n IA",inputs:[{name:"aiDescription",type:"textarea",placeholder:"Descripci\xf3n generada por IA...",value:t.selectedPhoto.aiDescription||""}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Guardar",handler:(r=(0,f.A)(function*(c){if(t.selectedPhoto){t.selectedPhoto.aiDescription=c.aiDescription,yield t.storageService.updatePhoto(t.selectedPhoto);const a=t.photos.findIndex(p=>p.id===t.selectedPhoto.id);a>=0&&(t.photos[a]={...t.selectedPhoto})}}),function(a){return r.apply(this,arguments)})}]})).present())})()}analyzePhotoWithAI(){var t=this;return(0,f.A)(function*(){if(t.selectedPhoto){t.isAnalyzingPhoto=!0;try{const o=t.selectedPhoto.imageUrl||t.selectedPhoto.localPath||t.selectedPhoto.imagePath||"",r=yield t.claudeService.analyzeImage(o);t.selectedPhoto.aiDescription=r,yield t.storageService.updatePhoto(t.selectedPhoto);const c=t.photos.findIndex(a=>a.id===t.selectedPhoto.id);c>=0&&(t.photos[c]={...t.selectedPhoto})}catch{}finally{t.isAnalyzingPhoto=!1}}})()}onImageError(t){t.target.style.display="none";const o=t.target.parentElement;if(o&&!o.querySelector(".photo-placeholder")){const r=document.createElement("div");r.className="photo-placeholder",r.innerHTML='<ion-icon name="image-outline"></ion-icon>',o.insertBefore(r,t.target)}}openReportViewer(t){this.selectedReport=t,this.selectedReportHtml=this.sanitizer.bypassSecurityTrustHtml(t.htmlContent),this.showReportViewer=!0}closeReportViewer(){this.showReportViewer=!1,this.selectedReport=null,this.selectedReportHtml=""}downloadReportAsWord(t){var o=this;return(0,f.A)(function*(){if(!t||!o.project)return;const r=new Blob([t.htmlContent],{type:"text/html"}),c=URL.createObjectURL(r),a=document.createElement("a");a.href=c,a.download=`${t.name.replace(/\s+/g,"_")}.html`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(c)})()}deleteReport(t){var o=this;return(0,f.A)(function*(){var c;o.project&&(yield(yield o.alertCtrl.create({header:"Eliminar informe",message:"\xbfSeguro que quieres eliminar este informe?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:(c=(0,f.A)(function*(){try{yield(0,k._)(o.apiService.deleteReport(t.id)),console.log("Informe eliminado del servidor:",t.id)}catch(a){console.log("Error eliminando del servidor:",a?.message)}o.project.reports=o.project.reports?.filter(a=>a.id!==t.id),yield o.storageService.saveProject(o.project),o.closeReportViewer()}),function(){return c.apply(this,arguments)})}]})).present())})()}openKmlViewer(t){this.selectedKml=t,this.showKmlViewer=!0,setTimeout(()=>this.initKmlMap(t),100)}closeKmlViewer(){this.kmlMap&&(this.kmlMap.remove(),this.kmlMap=null),this.showKmlViewer=!1,this.selectedKml=null}initKmlMap(t){document.getElementById("kmlViewerMap")&&(this.kmlMap=j.map("kmlViewerMap",{zoomControl:!0,attributionControl:!1}).setView([40.4168,-3.7038],6),j.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19}).addTo(this.kmlMap),this.renderKmlOnMap(t.kmlContent))}renderKmlOnMap(t){if(this.kmlMap)try{const r=(new DOMParser).parseFromString(t,"text/xml"),c=j.latLngBounds([]);this.injectKmlPopupStyles();const a=r.getElementsByTagName("Placemark");for(let p=0;p<a.length;p++){const d=a[p],g=d.getElementsByTagName("name")[0]?.textContent||"Sin nombre";let m="";const y=d.getElementsByTagName("description")[0];y&&(m=y.textContent||"");const F=d.getElementsByTagName("Point");for(let v=0;v<F.length;v++){const C=F[v].getElementsByTagName("coordinates")[0]?.textContent?.trim();if(C){const[x,u]=C.split(",").map(Number);if(!isNaN(u)&&!isNaN(x)){const _=j.marker([u,x]).addTo(this.kmlMap),b=`\n                <div class="kml-popup-content">\n                  <h3 class="kml-popup-title">${this.escapeHtml(g)}</h3>\n                  <div class="kml-popup-description">${m}</div>\n                </div>\n              `;_.bindPopup(b,{maxWidth:450,maxHeight:500,className:"kml-rich-popup"}),c.extend([u,x])}}}const R=d.getElementsByTagName("LineString");for(let v=0;v<R.length;v++){const C=R[v].getElementsByTagName("coordinates")[0]?.textContent?.trim();if(C){const x=C.split(/\s+/).map(u=>{const[_,b]=u.split(",").map(Number);return[b,_]}).filter(([u,_])=>!isNaN(u)&&!isNaN(_));x.length>0&&(j.polyline(x,{color:"#3b82f6",weight:4}).addTo(this.kmlMap).bindPopup(`<strong>${this.escapeHtml(g)}</strong><br>${m}`),x.forEach(_=>c.extend(_)))}}const E=d.getElementsByTagName("Polygon");for(let v=0;v<E.length;v++){const x=E[v].getElementsByTagName("outerBoundaryIs")[0]?.getElementsByTagName("coordinates")[0]?.textContent?.trim();if(x){const u=x.split(/\s+/).map(_=>{const[b,_e]=_.split(",").map(Number);return[_e,b]}).filter(([_,b])=>!isNaN(_)&&!isNaN(b));u.length>0&&(j.polygon(u,{color:"#10b981",fillOpacity:.3}).addTo(this.kmlMap).bindPopup(`<strong>${this.escapeHtml(g)}</strong><br>${m}`),u.forEach(b=>c.extend(b)))}}}c.isValid()&&this.kmlMap.fitBounds(c,{padding:[20,20]})}catch(o){console.error("Error parsing KML:",o)}}injectKmlPopupStyles(){if(document.getElementById("kml-popup-styles"))return;const t=document.createElement("style");t.id="kml-popup-styles",t.textContent="\n      .kml-rich-popup .leaflet-popup-content-wrapper {\n        background: #1e293b;\n        color: #f1f5f9;\n        border-radius: 12px;\n        box-shadow: 0 4px 20px rgba(0,0,0,0.5);\n      }\n      .kml-rich-popup .leaflet-popup-tip {\n        background: #1e293b;\n      }\n      .kml-rich-popup .leaflet-popup-close-button {\n        color: #94a3b8;\n      }\n      .kml-popup-content {\n        max-width: 420px;\n        max-height: 450px;\n        overflow-y: auto;\n        padding: 4px;\n      }\n      .kml-popup-title {\n        margin: 0 0 12px 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: #3b82f6;\n        border-bottom: 1px solid #334155;\n        padding-bottom: 8px;\n      }\n      .kml-popup-description {\n        font-size: 14px;\n        line-height: 1.5;\n      }\n      .kml-popup-description img {\n        max-width: 100%;\n        max-height: 250px;\n        border-radius: 8px;\n        margin: 8px 0;\n        display: block;\n        object-fit: contain;\n      }\n      .kml-popup-description p {\n        margin: 8px 0;\n      }\n      .kml-popup-description hr {\n        border: none;\n        border-top: 1px solid #334155;\n        margin: 12px 0;\n      }\n      .kml-popup-description h4 {\n        color: #94a3b8;\n        font-size: 14px;\n        margin: 12px 0 8px 0;\n      }\n    ",document.head.appendChild(t)}escapeHtml(t){const o=document.createElement("div");return o.textContent=t,o.innerHTML}downloadKml(t){if(!t)return;const o=new Blob([t.kmlContent],{type:"application/vnd.google-earth.kml+xml"}),r=URL.createObjectURL(o),c=document.createElement("a");c.href=r,c.download=`${t.name}.kml`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)}deleteKml(t){var o=this;return(0,f.A)(function*(){var c;o.project&&(yield(yield o.alertCtrl.create({header:"Eliminar archivo KML",message:"\xbfSeguro que quieres eliminar este archivo?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:(c=(0,f.A)(function*(){try{yield(0,k._)(o.apiService.deleteKml(t.id)),console.log("KML eliminado del servidor:",t.id)}catch(a){console.log("Error eliminando del servidor:",a?.message)}o.project.kmls=o.project.kmls?.filter(a=>a.id!==t.id),yield o.storageService.saveProject(o.project),o.closeKmlViewer()}),function(){return c.apply(this,arguments)})}]})).present())})()}get reportCount(){return this.project?.reports?.length||0}get kmlCount(){return this.project?.kmls?.length||0}get zoneCount(){return this.project?.zones?.length||0}get pathCount(){return this.project?.paths?.length||0}get markerCount(){return this.project?.markers?.length||0}get totalDocuments(){return this.reportCount+this.kmlCount}static#e=i=()=>(this.\u0275fac=function(o){return new(o||l)(e.rXU(z.nX),e.rXU(T.n),e.rXU(G.c),e.rXU(V.G),e.rXU($.o),e.rXU(B.G),e.rXU(S.up),e.rXU(I.q9),e.rXU(P.hG),e.rXU(I.OD))},this.\u0275cmp=e.VBU({type:l,selectors:[["app-project-detail"]],standalone:!1,decls:15,vars:8,consts:[["slot","start"],[3,"click"],["name","arrow-back-outline","slot","icon-only"],[1,"project-detail-content"],["class","project-info",4,"ngIf"],["class","photos-section",4,"ngIf"],["class","empty-photos",4,"ngIf"],["class","documents-section",4,"ngIf"],["class","photo-viewer-overlay",3,"click",4,"ngIf"],["class","report-viewer-overlay",4,"ngIf"],["class","kml-viewer-overlay",4,"ngIf"],[1,"project-info"],[1,"info-card"],[1,"project-name"],["class","project-description",4,"ngIf"],[1,"info-row"],["name","location-outline"],["name","calendar-outline"],["name","images-outline"],["name","map-outline"],["name","folder-outline"],[1,"sync-status"],["class","sync-badge synced",4,"ngIf"],["class","sync-badge local",4,"ngIf"],["expand","block","color","primary",1,"edit-map-btn",3,"click"],["slot","start","name","map-outline"],[1,"project-description"],[1,"sync-badge","synced"],["name","cloud-done-outline"],[1,"sync-badge","local"],["name","phone-portrait-outline"],[1,"photos-section"],[1,"section-title"],[1,"photos-grid"],["class","photo-card",3,"click",4,"ngFor","ngForOf"],[1,"photo-card",3,"click"],["alt","Foto",3,"src","error",4,"ngIf"],["class","photo-placeholder",4,"ngIf"],[1,"photo-info"],["class","photo-date",4,"ngIf"],["class","photo-coords",4,"ngIf"],[1,"photo-indicators"],["name","sparkles","class","indicator-ai",4,"ngIf"],["name","document-text","class","indicator-notes",4,"ngIf"],["alt","Foto",3,"error","src"],[1,"photo-placeholder"],["name","image-outline"],[1,"photo-date"],[1,"photo-coords"],["name","sparkles",1,"indicator-ai"],["name","document-text",1,"indicator-notes"],[1,"empty-photos"],[1,"empty-photos-content"],[1,"documents-section"],[1,"documents-grid"],["class","document-card report-card",3,"click",4,"ngFor","ngForOf"],["class","document-card kml-card",3,"click",4,"ngFor","ngForOf"],[1,"document-card","report-card",3,"click"],[1,"document-icon"],["name","document-text"],[1,"document-type"],[1,"document-name"],[1,"document-date"],[1,"document-card","kml-card",3,"click"],["name","earth"],[1,"photo-viewer-overlay",3,"click"],[1,"photo-viewer-container",3,"click"],[1,"close-btn",3,"click"],["name","close"],[1,"viewer-image"],[1,"viewer-content"],["class","viewer-section location-section",4,"ngIf"],["class","viewer-section",4,"ngIf"],["class","viewer-section ai-section",3,"click",4,"ngIf"],["class","viewer-section notes-section",3,"click",4,"ngIf"],["class","viewer-date",4,"ngIf"],[1,"viewer-actions"],[1,"action-btn","edit-btn",3,"click"],["name","create-outline"],["class","action-btn ai-btn",3,"click",4,"ngIf"],["class","action-btn ai-btn analyzing","disabled","",4,"ngIf"],[1,"delete-photo-btn",3,"click"],["name","trash-outline"],[1,"viewer-section","location-section"],[1,"viewer-section-header"],["name","navigate"],[1,"viewer-text"],[1,"viewer-section"],["name","location"],[1,"viewer-coords"],[1,"viewer-section","ai-section",3,"click"],["name","sparkles"],["name","create-outline",1,"edit-icon"],[1,"viewer-section","notes-section",3,"click"],[1,"viewer-date"],[1,"action-btn","ai-btn",3,"click"],["name","sparkles-outline"],["disabled","",1,"action-btn","ai-btn","analyzing"],["name","crescent"],[1,"report-viewer-overlay"],[1,"report-viewer-header"],["fill","clear",3,"click"],["slot","icon-only","name","arrow-back"],[1,"header-spacer"],[1,"report-viewer-content",3,"innerHTML"],[1,"report-viewer-actions"],["color","danger","fill","outline",3,"click"],["slot","start","name","trash-outline"],["color","primary",3,"click"],["slot","start","name","download-outline"],[1,"kml-viewer-overlay"],[1,"kml-viewer-header"],[1,"kml-viewer-map-container"],["id","kmlViewerMap",1,"kml-map"],[1,"kml-viewer-actions"]],template:function(o,r){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return r.goBack()}),e.nrm(4,"ion-icon",2),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6),e.k0s()()(),e.j41(7,"ion-content",3),e.DNE(8,K,31,16,"div",4)(9,Q,5,1,"div",5)(10,q,5,0,"div",6)(11,oe,6,2,"div",7),e.k0s(),e.DNE(12,de,22,10,"div",8)(13,ge,15,2,"div",9)(14,me,16,1,"div",10)),2&o&&(e.R7$(6),e.JRh((null==r.project?null:r.project.name)||"Proyecto"),e.R7$(2),e.Y8G("ngIf",r.project),e.R7$(),e.Y8G("ngIf",r.photos.length>0),e.R7$(),e.Y8G("ngIf",0===r.photos.length),e.R7$(),e.Y8G("ngIf",r.totalDocuments>0),e.R7$(),e.Y8G("ngIf",r.showPhotoViewer&&r.selectedPhoto),e.R7$(),e.Y8G("ngIf",r.showReportViewer&&r.selectedReport),e.R7$(),e.Y8G("ngIf",r.showKmlViewer&&r.selectedKml))},dependencies:[w.Sq,w.bT,P.Jm,P.QW,P.W9,P.eU,P.iq,P.w2,P.BC,P.ai],styles:['ion-back-button[_ngcontent-%COMP%]{--color: var(--geotech-accent-cyan) !important;display:block!important}.project-detail-content[_ngcontent-%COMP%]{--background: var(--geotech-bg-dark)}.project-info[_ngcontent-%COMP%]{padding:20px}.info-card[_ngcontent-%COMP%]{background:var(--geotech-bg-glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:var(--geotech-radius-lg);padding:24px;border:1px solid var(--geotech-border-glass)}.project-name[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:var(--geotech-text-primary);margin:0 0 8px}.project-description[_ngcontent-%COMP%]{font-size:15px;color:var(--geotech-text-secondary);margin:0 0 20px;line-height:1.6}.info-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:14px 0;border-bottom:1px solid var(--geotech-border-glass);color:var(--geotech-text-secondary);font-size:14px}.info-row[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.info-row[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:var(--geotech-accent-cyan)}.sync-status[_ngcontent-%COMP%]{margin-top:20px;padding-top:20px;border-top:1px solid var(--geotech-border-glass)}.sync-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-size:13px;font-weight:600;padding:8px 16px;border-radius:100px}.sync-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.sync-badge.local[_ngcontent-%COMP%]{background:#00d4ff26;color:var(--geotech-accent-cyan);border:1px solid rgba(0,212,255,.3)}.sync-badge.synced[_ngcontent-%COMP%]{background:#10b98126;color:#10b981;border:1px solid rgba(16,185,129,.3)}.edit-map-btn[_ngcontent-%COMP%]{margin-top:20px;--border-radius: 12px;--background: var(--ion-color-primary);--box-shadow: 0 4px 12px rgba(59, 130, 246, .3);font-weight:600}.photos-section[_ngcontent-%COMP%]{padding:0 20px 20px}.section-title[_ngcontent-%COMP%]{font-size:.7rem;font-weight:700;color:var(--geotech-accent-cyan);text-transform:uppercase;letter-spacing:1.5px;margin:0 0 16px}.photos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}.photo-card[_ngcontent-%COMP%]{background:var(--geotech-bg-glass);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:var(--geotech-radius-md);overflow:hidden;border:1px solid var(--geotech-border-glass);transition:all .3s ease}.photo-card[_ngcontent-%COMP%]:hover{border-color:#00d4ff4d;box-shadow:var(--geotech-glow-cyan)}.photo-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:120px;object-fit:cover}.photo-placeholder[_ngcontent-%COMP%]{width:100%;height:120px;background:var(--geotech-bg-glass);display:flex;align-items:center;justify-content:center}.photo-placeholder[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:40px;color:var(--geotech-text-muted)}.photo-info[_ngcontent-%COMP%]{padding:12px}.photo-date[_ngcontent-%COMP%]{display:block;font-size:12px;color:var(--geotech-text-secondary);font-weight:500}.photo-coords[_ngcontent-%COMP%]{display:block;font-size:11px;color:var(--geotech-accent-cyan);font-family:SF Mono,monospace;margin-top:4px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px 24px;text-align:center}.empty-icon[_ngcontent-%COMP%]{width:88px;height:88px;border-radius:50%;background:var(--geotech-bg-glass);border:1px solid var(--geotech-border-glass);display:flex;align-items:center;justify-content:center;margin-bottom:20px}.empty-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:40px;color:var(--geotech-text-muted)}.empty-title[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:var(--geotech-text-primary);margin:0 0 8px}.empty-description[_ngcontent-%COMP%]{font-size:14px;color:var(--geotech-text-muted);max-width:260px;margin:0;line-height:1.5}.photo-card[_ngcontent-%COMP%]{cursor:pointer;position:relative}.photo-indicators[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:flex;gap:6px}.photo-indicators[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:24px;height:24px;padding:4px;border-radius:6px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.photo-indicators[_ngcontent-%COMP%]   .indicator-ai[_ngcontent-%COMP%]{background:#7c3aedcc;color:#fff}.photo-indicators[_ngcontent-%COMP%]   .indicator-notes[_ngcontent-%COMP%]{background:#00d4ffcc;color:#fff}.photo-viewer-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000f2;z-index:99999;display:flex;align-items:center;justify-content:center;padding:20px;padding-top:calc(20px + var(--ion-safe-area-top, 0px));animation:_ngcontent-%COMP%_fadeIn .2s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.photo-viewer-container[_ngcontent-%COMP%]{width:100%;max-width:500px;max-height:90vh;overflow-y:auto;background:var(--geotech-bg-glass);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:var(--geotech-radius-xl);border:1px solid var(--geotech-border-glass);position:relative}.close-btn[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;width:40px;height:40px;border:none;background:#00000080;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;transition:all .2s ease}.close-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#fff}.close-btn[_ngcontent-%COMP%]:hover{background:#ef4444cc}.viewer-image[_ngcontent-%COMP%]{width:100%}.viewer-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;display:block;border-radius:var(--geotech-radius-xl) var(--geotech-radius-xl) 0 0}.viewer-content[_ngcontent-%COMP%]{padding:20px}.viewer-section[_ngcontent-%COMP%]{margin-bottom:20px;padding:16px;background:#0003;border-radius:var(--geotech-radius-md);border:1px solid var(--geotech-border-glass)}.viewer-section[_ngcontent-%COMP%]:last-of-type{margin-bottom:0}.viewer-section-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:12px}.viewer-section-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:var(--geotech-accent-cyan)}.viewer-section-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;font-weight:700;color:var(--geotech-accent-cyan);text-transform:uppercase;letter-spacing:1px;flex:1}.viewer-section-header[_ngcontent-%COMP%]   .edit-icon[_ngcontent-%COMP%]{font-size:16px;opacity:.6;transition:opacity .2s}.viewer-section.ai-section[_ngcontent-%COMP%], .viewer-section.notes-section[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease}.viewer-section.ai-section[_ngcontent-%COMP%]:hover, .viewer-section.ai-section[_ngcontent-%COMP%]:active, .viewer-section.notes-section[_ngcontent-%COMP%]:hover, .viewer-section.notes-section[_ngcontent-%COMP%]:active{transform:scale(1.01)}.viewer-section.ai-section[_ngcontent-%COMP%]:hover   .edit-icon[_ngcontent-%COMP%], .viewer-section.ai-section[_ngcontent-%COMP%]:active   .edit-icon[_ngcontent-%COMP%], .viewer-section.notes-section[_ngcontent-%COMP%]:hover   .edit-icon[_ngcontent-%COMP%], .viewer-section.notes-section[_ngcontent-%COMP%]:active   .edit-icon[_ngcontent-%COMP%]{opacity:1}.viewer-coords[_ngcontent-%COMP%]{font-family:SF Mono,monospace;font-size:14px;color:var(--geotech-accent-cyan);margin:0}.viewer-text[_ngcontent-%COMP%]{font-size:14px;color:var(--geotech-text-secondary);line-height:1.6;margin:0;white-space:pre-wrap}.viewer-section.ai-section[_ngcontent-%COMP%]{border-color:#7c3aed4d}.viewer-section.ai-section[_ngcontent-%COMP%]   .viewer-section-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .viewer-section.ai-section[_ngcontent-%COMP%]   .viewer-section-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--geotech-accent-purple)}.viewer-section.notes-section[_ngcontent-%COMP%]{border-color:#10b9814d}.viewer-section.notes-section[_ngcontent-%COMP%]   .viewer-section-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .viewer-section.notes-section[_ngcontent-%COMP%]   .viewer-section-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--geotech-accent-green)}.viewer-section.notes-section[_ngcontent-%COMP%]   .viewer-text[_ngcontent-%COMP%]{color:var(--geotech-text-primary)}.viewer-section.location-section[_ngcontent-%COMP%]{border-color:#f59e0b4d}.viewer-section.location-section[_ngcontent-%COMP%]   .viewer-section-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .viewer-section.location-section[_ngcontent-%COMP%]   .viewer-section-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--geotech-accent-orange)}.viewer-date[_ngcontent-%COMP%]{text-align:center;font-size:12px;color:var(--geotech-text-muted);margin-top:16px;padding-top:16px;border-top:1px solid var(--geotech-border-glass)}.viewer-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:16px}.action-btn[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:8px;padding:12px 16px;border-radius:var(--geotech-radius-md);font-size:14px;font-weight:600;cursor:pointer;transition:all .3s ease;border:none}.action-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.action-btn[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:18px;height:18px}.edit-btn[_ngcontent-%COMP%]{background:#3b82f626;border:1px solid rgba(59,130,246,.4);color:#3b82f6}.edit-btn[_ngcontent-%COMP%]:hover, .edit-btn[_ngcontent-%COMP%]:active{background:#3b82f640}.ai-btn[_ngcontent-%COMP%]{background:#7c3aed26;border:1px solid rgba(124,58,237,.4);color:#7c3aed}.ai-btn[_ngcontent-%COMP%]:hover, .ai-btn[_ngcontent-%COMP%]:active{background:#7c3aed40}.ai-btn.analyzing[_ngcontent-%COMP%]{opacity:.7;cursor:not-allowed}.delete-photo-btn[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;gap:10px;margin-top:20px;padding:14px 20px;background:#ef444426;border:1px solid rgba(239,68,68,.4);border-radius:var(--geotech-radius-md);color:#ef4444;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s ease}.delete-photo-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.delete-photo-btn[_ngcontent-%COMP%]:hover, .delete-photo-btn[_ngcontent-%COMP%]:active{background:#ef444440;border-color:#ef444499;box-shadow:0 0 20px #ef44444d}.empty-photos[_ngcontent-%COMP%]{padding:0 20px 20px}.empty-photos-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;background:var(--geotech-bg-glass);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:var(--geotech-radius-lg);border:1px solid var(--geotech-border-glass);text-align:center}.empty-photos-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:var(--geotech-text-muted);margin-bottom:12px}.empty-photos-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;color:var(--geotech-text-muted)}.documents-section[_ngcontent-%COMP%]{padding:0 20px 20px}.documents-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}.document-card[_ngcontent-%COMP%]{background:var(--geotech-bg-glass);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:var(--geotech-radius-md);padding:20px 16px;border:1px solid var(--geotech-border-glass);cursor:pointer;transition:all .3s ease;display:flex;flex-direction:column;align-items:center;text-align:center;gap:8px}.document-card[_ngcontent-%COMP%]:hover, .document-card[_ngcontent-%COMP%]:active{border-color:#00d4ff4d;box-shadow:var(--geotech-glow-cyan);transform:translateY(-2px)}.document-icon[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:16px;display:flex;align-items:center;justify-content:center;margin-bottom:4px}.document-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:28px;color:#fff}.report-card[_ngcontent-%COMP%]   .document-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#1d4ed8);box-shadow:0 4px 15px #3b82f666}.kml-card[_ngcontent-%COMP%]   .document-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);box-shadow:0 4px 15px #10b98166}.document-type[_ngcontent-%COMP%]{font-size:10px;font-weight:700;letter-spacing:1px;padding:4px 10px;border-radius:100px;text-transform:uppercase}.report-card[_ngcontent-%COMP%]   .document-type[_ngcontent-%COMP%]{background:#3b82f633;color:#60a5fa}.kml-card[_ngcontent-%COMP%]   .document-type[_ngcontent-%COMP%]{background:#10b98133;color:#34d399}.document-name[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:var(--geotech-text-primary);line-height:1.3;word-break:break-word}.document-date[_ngcontent-%COMP%]{font-size:11px;color:var(--geotech-text-muted)}.reports-section[_ngcontent-%COMP%], .kml-section[_ngcontent-%COMP%]{padding:0 20px 20px}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.section-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.files-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.file-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px;background:var(--geotech-bg-glass);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:var(--geotech-radius-md);border:1px solid var(--geotech-border-glass);cursor:pointer;transition:all .3s ease}.file-card[_ngcontent-%COMP%]:hover, .file-card[_ngcontent-%COMP%]:active{border-color:#00d4ff4d;box-shadow:var(--geotech-glow-cyan)}.file-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center}.file-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#fff}.report-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#1d4ed8)}.kml-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669)}.file-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:4px}.file-name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:var(--geotech-text-primary)}.file-date[_ngcontent-%COMP%]{font-size:12px;color:var(--geotech-text-muted)}.file-arrow[_ngcontent-%COMP%]{font-size:20px;color:var(--geotech-text-muted)}.report-viewer-overlay[_ngcontent-%COMP%], .kml-viewer-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#fff;z-index:99999;display:flex;flex-direction:column;animation:_ngcontent-%COMP%_fadeIn .2s ease}.report-viewer-header[_ngcontent-%COMP%], .kml-viewer-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 16px;padding-top:calc(12px + var(--ion-safe-area-top, 0px));background:var(--ion-color-primary);color:#fff;gap:8px}.report-viewer-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .kml-viewer-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:600;flex:1}.report-viewer-header[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%], .kml-viewer-header[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--color: white;margin:0}.report-viewer-header[_ngcontent-%COMP%]   .header-spacer[_ngcontent-%COMP%], .kml-viewer-header[_ngcontent-%COMP%]   .header-spacer[_ngcontent-%COMP%]{width:40px}.report-viewer-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:0;background:#f5f5f5}.kml-viewer-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;display:flex;align-items:center;justify-content:center;background:var(--geotech-bg-dark)}.kml-preview[_ngcontent-%COMP%]{text-align:center;padding:40px}.kml-preview[_ngcontent-%COMP%]   .kml-big-icon[_ngcontent-%COMP%]{font-size:80px;color:#10b981;margin-bottom:20px}.kml-preview[_ngcontent-%COMP%]   .kml-info[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:var(--geotech-text-primary);margin:0 0 8px}.kml-preview[_ngcontent-%COMP%]   .kml-date[_ngcontent-%COMP%]{font-size:14px;color:var(--geotech-text-muted);margin:0}.report-viewer-actions[_ngcontent-%COMP%], .kml-viewer-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;padding:12px 16px;background:#fff;border-top:1px solid #e0e0e0;box-shadow:0 -2px 8px #0000001a}.report-viewer-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%], .kml-viewer-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;font-weight:600}.kml-viewer-map-container[_ngcontent-%COMP%]{flex:1;position:relative;overflow:hidden}.kml-map[_ngcontent-%COMP%]{width:100%;height:100%;min-height:300px}.kml-viewer-overlay[_ngcontent-%COMP%]   .leaflet-pane[_ngcontent-%COMP%]{z-index:1}.kml-viewer-overlay[_ngcontent-%COMP%]   .leaflet-control-zoom[_ngcontent-%COMP%]{margin-right:20px;margin-bottom:20px;border:none!important;box-shadow:0 2px 10px #0000004d}.kml-viewer-overlay[_ngcontent-%COMP%]   .leaflet-control-zoom[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:#fffffff2;color:#333;width:36px;height:36px;line-height:36px;font-size:18px}.kml-viewer-overlay[_ngcontent-%COMP%]   .leaflet-control-zoom[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background:#fff}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content-wrapper{border-radius:16px!important;box-shadow:0 8px 32px #0006!important;max-width:400px!important;background:linear-gradient(145deg,#1e293b,#0f172a)!important;border:1px solid rgba(255,255,255,.1)!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-tip{background:#1e293b!important;border:1px solid rgba(255,255,255,.1)!important;border-top:none!important;border-left:none!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-close-button{color:#ffffffb3!important;font-size:20px!important;top:8px!important;right:10px!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-close-button:hover{color:#fff!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content{margin:16px 20px!important;font-size:14px!important;line-height:1.5!important;max-width:380px!important;color:#ffffffe6!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content h3{margin:0 0 12px!important;color:#fff!important;font-size:18px!important;font-weight:600!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content h4{margin:12px 0 8px!important;color:#fffc!important;font-size:14px!important;font-weight:600!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content p{margin:8px 0!important;color:#fffc!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content strong{color:#fff!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content hr{border:none!important;border-top:1px solid rgba(255,255,255,.15)!important;margin:16px 0!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content img{max-width:100%!important;height:auto!important;border-radius:12px!important;margin:12px 0!important;box-shadow:0 4px 16px #0000004d!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content div[style*="background:#e8ffe8"], .kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content div[style*="background: #e8ffe8"]{background:#10b98126!important;border:1px solid rgba(16,185,129,.3)!important;border-radius:8px!important;padding:10px!important;margin:8px 0!important;color:#34d399!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content div[style*="background:#fff3e0"], .kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content div[style*="background: #fff3e0"], .kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content div[style*="background:#e3f2fd"], .kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content div[style*="background: #e3f2fd"]{background:#f59e0b26!important;border:1px solid rgba(245,158,11,.3)!important;border-radius:8px!important;padding:10px!important;margin:8px 0!important;color:#fbbf24!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .leaflet-popup-content div[style*="border:1px solid #ddd"]{background:#ffffff0d!important;border:1px solid rgba(255,255,255,.15)!important;border-radius:12px!important;padding:12px!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .kml-rich-popup .leaflet-popup-content-wrapper{max-width:420px!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .kml-rich-popup .leaflet-popup-content{max-height:450px!important;overflow-y:auto!important;padding-right:8px!important}.kml-viewer-overlay[_ngcontent-%COMP%]     .kml-rich-popup .leaflet-popup-content::-webkit-scrollbar{width:6px}.kml-viewer-overlay[_ngcontent-%COMP%]     .kml-rich-popup .leaflet-popup-content::-webkit-scrollbar-track{background:#ffffff0d;border-radius:3px}.kml-viewer-overlay[_ngcontent-%COMP%]     .kml-rich-popup .leaflet-popup-content::-webkit-scrollbar-thumb{background:#fff3;border-radius:3px}.kml-viewer-overlay[_ngcontent-%COMP%]     .kml-rich-popup .leaflet-popup-content::-webkit-scrollbar-thumb:hover{background:#ffffff4d}']}))}return i(),l})()}];let fe=(()=>{var i;class l{static#e=i=()=>(this.\u0275fac=function(o){return new(o||l)},this.\u0275mod=e.$C({type:l}),this.\u0275inj=s.G2t({imports:[O.iI.forChild(he),O.iI]}))}return i(),l})(),ue=(()=>{var i;class l{static#e=i=()=>(this.\u0275fac=function(o){return new(o||l)},this.\u0275mod=e.$C({type:l}),this.\u0275inj=s.G2t({imports:[w.MD,D.YN,P.bv,fe]}))}return i(),l})()}}]);