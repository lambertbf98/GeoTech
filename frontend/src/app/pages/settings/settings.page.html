<ion-header>
  <ion-toolbar>
    <ion-title>Ajustes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="settings-content">
  <!-- User info -->
  <div class="user-card">
    <div class="user-avatar" (click)="selectProfilePhoto()">
      <img *ngIf="userPhoto" [src]="userPhoto" alt="Foto de perfil">
      <ion-icon *ngIf="!userPhoto" name="person"></ion-icon>
      <div class="avatar-edit-badge">
        <ion-icon name="camera"></ion-icon>
      </div>
    </div>
    <div class="user-info">
      <h2>{{ userName }}</h2>
      <p>{{ userEmail }}</p>
    </div>
  </div>

  <!-- License section -->
  <div class="section license-section">
    <div class="section-header">Licencia</div>
    <ion-list class="settings-list">
      <!-- Estado de licencia -->
      <ion-item *ngIf="loadingLicense">
        <ion-spinner name="crescent" slot="start"></ion-spinner>
        <ion-label>Verificando licencia...</ion-label>
      </ion-item>

      <!-- Con licencia activa -->
      <ion-item *ngIf="!loadingLicense && hasLicense && currentLicense" class="license-active">
        <ion-icon name="shield-checkmark" slot="start" color="success"></ion-icon>
        <ion-label>
          <h3>Licencia {{ currentLicense.type }}</h3>
          <p>{{ formatDaysRemaining(currentLicense.daysRemaining) }}</p>
          <p class="license-key">{{ currentLicense.licenseKey }}</p>
        </ion-label>
        <ion-badge slot="end" color="success">Activa</ion-badge>
      </ion-item>

      <!-- Sin licencia -->
      <ion-item *ngIf="!loadingLicense && !hasLicense" class="license-inactive">
        <ion-icon name="warning" slot="start" color="warning"></ion-icon>
        <ion-label>
          <h3>Sin licencia activa</h3>
          <p>Activa o compra una licencia para usar todas las funciones</p>
        </ion-label>
      </ion-item>

      <!-- Acciones -->
      <ion-item button (click)="activateLicenseKey()" *ngIf="!loadingLicense">
        <ion-icon name="key-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Activar clave</h3>
          <p>Introduce una clave de licencia</p>
        </ion-label>
        <ion-icon name="chevron-forward-outline" slot="end" class="chevron-icon"></ion-icon>
      </ion-item>

      <ion-item button (click)="showLicenseOptions()" *ngIf="!loadingLicense && licenseTypes.length > 0">
        <ion-icon name="card-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Comprar licencia</h3>
          <p>Adquiere una licencia via PayPal</p>
        </ion-label>
        <ion-icon name="chevron-forward-outline" slot="end" class="chevron-icon"></ion-icon>
      </ion-item>
    </ion-list>
  </div>

  <!-- Profile section -->
  <div class="section">
    <div class="section-header">Perfil</div>
    <ion-list class="settings-list">
      <ion-item button (click)="editName()">
        <ion-icon name="person-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Nombre</h3>
          <p>{{ userName }}</p>
        </ion-label>
        <ion-icon name="chevron-forward-outline" slot="end" class="chevron-icon"></ion-icon>
      </ion-item>
      <ion-item button (click)="editEmail()">
        <ion-icon name="mail-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Correo electronico</h3>
          <p>{{ userEmail }}</p>
        </ion-label>
        <ion-icon name="chevron-forward-outline" slot="end" class="chevron-icon"></ion-icon>
      </ion-item>
      <ion-item button (click)="changePassword()">
        <ion-icon name="lock-closed-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Cambiar contrasena</h3>
          <p>Actualiza tu contrasena</p>
        </ion-label>
        <ion-icon name="chevron-forward-outline" slot="end" class="chevron-icon"></ion-icon>
      </ion-item>
    </ion-list>
  </div>

  <!-- Sync section -->
  <div class="section">
    <div class="section-header">Sincronizacion</div>
    <ion-list class="settings-list">
      <ion-item button (click)="syncNow()">
        <ion-icon name="sync-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Sincronizar ahora</h3>
          <p *ngIf="pendingSync > 0">{{ pendingSync }} elementos pendientes</p>
          <p *ngIf="pendingSync === 0">Todo sincronizado</p>
        </ion-label>
        <ion-badge *ngIf="pendingSync > 0" color="warning" slot="end">{{ pendingSync }}</ion-badge>
      </ion-item>
      <ion-item>
        <ion-icon name="cloud-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Estado de conexion</h3>
          <p>{{ isOnline ? 'Conectado' : 'Sin conexion' }}</p>
        </ion-label>
        <div slot="end" class="status-indicator" [class.online]="isOnline"></div>
      </ion-item>
    </ion-list>
  </div>

  <!-- Storage section -->
  <div class="section">
    <div class="section-header">Almacenamiento</div>
    <ion-list class="settings-list">
      <ion-item button (click)="clearCache()">
        <ion-icon name="trash-outline" slot="start" color="danger"></ion-icon>
        <ion-label>
          <h3>Limpiar cache</h3>
          <p>Eliminar datos locales</p>
        </ion-label>
      </ion-item>
    </ion-list>
  </div>

  <!-- About section -->
  <div class="section">
    <div class="section-header">Acerca de</div>
    <ion-list class="settings-list">
      <ion-item>
        <ion-icon name="information-circle-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>Version</h3>
          <p>{{ appVersion }}</p>
        </ion-label>
      </ion-item>
    </ion-list>
  </div>

  <!-- Logout -->
  <div class="logout-section">
    <ion-button expand="block" color="danger" fill="outline" (click)="logout()">
      <ion-icon name="log-out-outline" slot="start"></ion-icon>
      Cerrar sesion
    </ion-button>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>GeoTech - Gestion de proyectos</p>
    <p>Aplicacion para ingenieria civil</p>
  </div>
</ion-content>
